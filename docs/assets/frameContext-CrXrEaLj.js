import{j as f}from"./jsx-runtime-D_zvdyIk.js";import{r as l}from"./iframe-m42l96Zd.js";const x=(e,t,i)=>Math.min(Math.max(e,t),i),I=(e,t,i,r)=>{const n=m(e,i);if(!n)return null;const a=e.chartAreaCanvasPX,s=(n.origin==="x"?a.width:a.height)/(n.max-n.min);return t/s},m=(e,t)=>e.scales.find(i=>i.id===t)??null,R=(e,t)=>{const i=window.devicePixelRatio||1;e.lineCap=t?.lineCap??"butt",e.lineDashOffset=i*(t?.lineDashOffset??0),e.lineJoin=t?.lineJoin??"miter",e.lineWidth=i*(t?.lineWidth??1),e.miterLimit=i*(t?.miterLimit??10),e.strokeStyle=t?.strokeStyle??"black",e.fillStyle=t?.fillStyle??e.strokeStyle,e.font=t?.font??`${10*i}px sans-serif`,e.textAlign=t?.textAlign??"start",e.direction=t?.direction??"inherit",e.textBaseline=t?.textBaseline??"alphabetic",e.fontKerning=t?.fontKerning??"auto"},S=(e,t,i,r)=>{const n=r==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,a=m(e,i);if(!a)return null;const s=(a.origin==="x"?n.width:n.height)/(a.max-a.min);return t*s},T=(e,t,i,r)=>{const n=m(e,i);if(!n)return null;const a=r==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,s=S(e,t-n.min,i,r);return s===null?null:n.origin==="x"?x(a.x+s,a.x-10*a.width,a.x+11*a.width):x(a.y+a.height-s,a.y-10*a.height,a.y+11*a.height)},D=(e,t,i)=>{if(t===null)return null;const r=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return x(t,r.x,r.x+r.width)},q=(e,t,i)=>{if(t===null)return null;const r=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return x(t,r.y,r.y+r.height)},F=(e,t,i)=>{if(t===null)return!1;const r=m(e,i);return r?t>=r.min&&t<=r.max:!1},N=(e,t,i,r)=>{const n=m(e,i);if(!n)return null;const a=e.chartAreaCSS,s=n.origin==="x"?(t-a.x)/a.width:(a.height-t+a.y)/a.height;return n.min+s*(n.max-n.min)},v=(e,t)=>{if(e===t)return!0;if(e==null||t==null||typeof e!=typeof t||typeof e!="object"||Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!v(e[n],t[n]))return!1;return!0}const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const n of i)if(!Object.prototype.hasOwnProperty.call(t,n)||!v(e[n],t[n]))return!1;return!0},O=e=>{const{ctx:t,scales:i}=e;for(const r of i){if(!r.axis)continue;t.save(),R(t,{strokeStyle:"black",fillStyle:"black",lineWidth:1,...r.axis.style});const n=r.axis.canvasRect;if(r.origin==="x"){if(r.axis.position==="bottom")t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.x+n.width,n.y),t.stroke();else if(r.axis.position==="top"){const a=n.y+n.height;t.beginPath(),t.moveTo(n.x,a),t.lineTo(n.x+n.width,a),t.stroke()}}else if(r.axis.position==="left"){const a=n.x+n.width;t.beginPath(),t.moveTo(a,n.y),t.lineTo(a,n.y+n.height),t.stroke()}else r.axis.position==="right"&&(t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.x,n.y+n.height),t.stroke());t.restore()}};function L(e){return t=>{for(const i of e)g(i,t)}}function j(e){return t=>{const i=[];for(const r of e){const n=g(r,t),a=typeof n=="function";i.push(a?n:()=>g(r,null))}return()=>{for(const r of i)r()}}}function g(e,t){if(typeof e=="function")return e(t);e&&(e.current=t)}var E=parseInt(l.version.split(".")[0],10)>=19?j:L;const C=l.createContext({listeners:[],subscribe:()=>()=>{},notifyListeners:()=>{}}),z=()=>{const e=[];return{listeners:e,subscribe:(r,n)=>(e.push([n,r]),e.sort((a,s)=>a[0]-s[0]),()=>{const a=e.findIndex(([,s])=>s===r);a!==-1&&e.splice(a,1)}),notifyListeners:()=>{for(const[,r]of e)r()}}},w=l.createContext(null),b=l.createContext(()=>{}),P={TOP:400,MIDDLE:300,BOTTOM:200,BACKGROUND:100};class k{_frame=null;_updateFrame(t){this._frame=t}get frame(){if(!this._frame)throw new Error("Frame not set in FrameDrawer");return this._frame}get ctx(){return this.frame.ctx}clampXPosToChartArea=(t,i="canvas")=>D(this.frame,t,i);clampYPosToChartArea=(t,i="canvas")=>q(this.frame,t,i);valToPos=(t,i,r="canvas")=>T(this.frame,t,i,r);valToPxDistance=(t,i,r="canvas")=>S(this.frame,t,i,r);valFits=(t,i)=>F(this.frame,t,i);getScale=t=>m(this.frame,t)}const M=l.forwardRef(({configuration:e,children:t,style:i,className:r},n)=>{const a=l.useRef(null),s=l.useRef(null),u=W(s),[c,p]=l.useState(null),d=l.useMemo(()=>X(e,u,c),[e,u,c]);l.useLayoutEffect(()=>{p(a.current?.getContext("2d")||null)},[a]);const y=window.devicePixelRatio||1;return f.jsxs("div",{ref:E([n,s]),className:r,style:{position:"relative",overflow:"hidden",...i},"data-canplotroot":!0,children:[f.jsx("canvas",{ref:a,width:u.width*y,height:u.height*y,style:{inset:0,position:"absolute",width:`${u.width}px`,height:`${u.height}px`}}),d&&f.jsx(_,{frame:d,children:t})]})}),_=({frame:e,children:t})=>{const i=l.useMemo(z,[]),[r,n]=l.useState(0);l.useLayoutEffect(()=>{e?.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height)},[e,r]);const a=l.useRef(null);a.current=e,l.useLayoutEffect(()=>{i.subscribe(()=>{a.current&&O(a.current)},P.BOTTOM)},[i]),l.useLayoutEffect(()=>{let u=null;return u=window.requestAnimationFrame(()=>{u=null,i.notifyListeners()}),()=>{u&&cancelAnimationFrame(u)}},[r,e,i]);const s=l.useCallback(()=>{n(u=>u+1)},[n]);return f.jsx(C.Provider,{value:i,children:f.jsx(b.Provider,{value:s,children:f.jsx(w.Provider,{value:e,children:t})})})},W=e=>{const[t,i]=l.useState({width:0,height:0}),[r]=l.useState(()=>new ResizeObserver(n=>{for(const a of n){const s=Math.round(a.contentRect.width),u=Math.round(a.contentRect.height);i(c=>c.width!==s||c.height!==u?{...c,width:s,height:u}:c)}}));return l.useLayoutEffect(()=>{if(!e.current)return;const n=e.current.clientWidth,a=e.current.clientHeight;return i(s=>s.width!==n||s.height!==a?{...s,width:n,height:a}:s),r.observe(e.current,{box:"border-box"}),()=>r.disconnect()},[r,e]),t},X=(e,t,i)=>{if(!i)return null;const r=window.devicePixelRatio||1;if(t.width===0||t.height===0)return null;const n={x:e.padding.left,y:e.padding.top,width:t.width-e.padding.left-e.padding.right,height:t.height-e.padding.top-e.padding.bottom};for(const o of e.scales)o.axis&&(o.origin==="x"?(o.axis.position==="bottom"||o.axis.position==="top")&&(n.height=Math.max(0,n.height-o.axis.size),o.axis.position==="top"&&(n.y+=o.axis.size)):(o.axis.position==="left"||o.axis.position==="right")&&(n.width=Math.max(0,n.width-o.axis.size),o.axis.position==="left"&&(n.x+=o.axis.size)));const a={x:n.x*r,y:n.y*r,width:n.width*r,height:n.height*r},s=[];let u=e.padding.left*r,c=t.width*r-e.padding.right*r,p=t.height*r-e.padding.bottom*r,d=e.padding.top*r;for(const o of e.scales){if(!o.axis){s.push({...o,axis:null});continue}let h;if(o.origin==="x")switch(o.axis.position){case"bottom":p-=o.axis.size*r,h={x:n.x,y:p/r,width:n.width,height:o.axis.size};break;case"top":d+=o.axis.size*r,h={x:n.x,y:d/r-o.axis.size,width:n.width,height:o.axis.size};break;case"left":case"right":throw new Error("Invalid axis position for x origin")}else switch(o.axis.position){case"left":u+=o.axis.size*r,h={x:u/r-o.axis.size,y:n.y,width:o.axis.size,height:n.height};break;case"right":c-=o.axis.size*r,h={x:c/r,y:n.y,width:o.axis.size,height:n.height};break;case"top":case"bottom":throw new Error("Invalid axis position for y origin")}const A={x:h.x*r,y:h.y*r,width:h.width*r,height:h.height*r};s.push({...o,axis:{...o.axis,cssRect:h,canvasRect:A}})}return{ctx:i,dpr:r,padding:e.padding,scales:s,chartAreaCSS:n,chartAreaCanvasPX:a}};M.__docgenInfo={description:"",methods:[],displayName:"CanPlot",props:{configuration:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  padding: PlotPadding;
  scales: PlotScaleConfig[];
}`,signature:{properties:[{key:"padding",value:{name:"signature",type:"object",raw:`{
  top: number;
  bottom: number;
  left: number;
  right: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"bottom",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}},{key:"right",value:{name:"number",required:!0}}]},required:!0}},{key:"scales",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  min: number;
  max: number;
  origin: "x" | "y";
  axis: null | PlotAxis;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"min",value:{name:"number",required:!0}},{key:"max",value:{name:"number",required:!0}},{key:"origin",value:{name:"union",raw:'"x" | "y"',elements:[{name:"literal",value:'"x"'},{name:"literal",value:'"y"'}],required:!0}},{key:"axis",value:{name:"union",raw:"null | PlotAxis",elements:[{name:"null"},{name:"signature",type:"object",raw:`{
  position: "left" | "right" | "top" | "bottom";
  size: number;
  style?: Style;
}`,signature:{properties:[{key:"position",value:{name:"union",raw:'"left" | "right" | "top" | "bottom"',elements:[{name:"literal",value:'"left"'},{name:"literal",value:'"right"'},{name:"literal",value:'"top"'},{name:"literal",value:'"bottom"'}],required:!0}},{key:"size",value:{name:"number",required:!0}},{key:"style",value:{name:"intersection",raw:`{
  fillStyle?: CanvasFillStrokeStyles["fillStyle"];
  strokeStyle?: CanvasFillStrokeStyles["strokeStyle"];
} & Partial<
  Pick<
    CanvasPathDrawingStyles,
    "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
  >
> &
  Partial<CanvasTextDrawingStyles>`,elements:[{name:"signature",type:"object",raw:`{
  fillStyle?: CanvasFillStrokeStyles["fillStyle"];
  strokeStyle?: CanvasFillStrokeStyles["strokeStyle"];
}`,signature:{properties:[{key:"fillStyle",value:{name:'CanvasFillStrokeStyles["fillStyle"]',raw:'CanvasFillStrokeStyles["fillStyle"]',required:!1}},{key:"strokeStyle",value:{name:'CanvasFillStrokeStyles["strokeStyle"]',raw:'CanvasFillStrokeStyles["strokeStyle"]',required:!1}}]}},{name:"Partial",elements:[{name:"Pick",elements:[{name:"CanvasPathDrawingStyles"},{name:"union",raw:'"lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"',elements:[{name:"literal",value:'"lineCap"'},{name:"literal",value:'"lineDashOffset"'},{name:"literal",value:'"lineJoin"'},{name:"literal",value:'"lineWidth"'},{name:"literal",value:'"miterLimit"'}]}],raw:`Pick<
  CanvasPathDrawingStyles,
  "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
>`}],raw:`Partial<
  Pick<
    CanvasPathDrawingStyles,
    "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
  >
>`},{name:"Partial",elements:[{name:"CanvasTextDrawingStyles"}],raw:"Partial<CanvasTextDrawingStyles>"}],required:!1}}]}}],required:!0}}]}}],raw:"PlotScaleConfig[]",required:!0}}]}},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};const V=(e,t,i)=>{const r=l.useContext(w),n=l.useContext(b),a=l.useContext(C);if(!r||!n)throw new Error("useFrame must be used within a CanPlot component");const[s]=l.useState(()=>new k);s._updateFrame(r);const u=l.useRef(s);u.current=s;const c=l.useRef(t);c.current=t,l.useLayoutEffect(()=>a.subscribe(()=>{c.current(s)},typeof e=="number"?e:P[e]),[a,e,s]),l.useLayoutEffect(()=>{n()},[n,...i])},K=()=>{const e=l.useContext(w);if(!e)throw new Error("useFrame must be used within a CanPlot component");return l.useMemo(()=>{const t=new k;return t._updateFrame(e),t},[e])};export{M as C,P as a,K as b,R as c,v as d,D as e,q as f,m as g,S as h,T as i,N as j,I as p,V as u,F as v};
