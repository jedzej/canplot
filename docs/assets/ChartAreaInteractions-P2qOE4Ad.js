import{j as q}from"./jsx-runtime-D_zvdyIk.js";import{R as j,r as w}from"./iframe-Dw0KNOgM.js";import{g as D,i as k,c as ce,h as Z,d as $,e as ee}from"./frameContext-DwsuiCxB.js";const R=()=>{const u=[];return{addEventListener:(n,s)=>(u.push({syncKey:n,callback:s}),()=>{const o=u.findIndex(v=>v.callback===s);o!==-1&&u.splice(o,1)}),dispatchEvent:(n,s)=>{for(const o of u)o.syncKey===n&&o.callback(n,s)}}},h={dblclick:R(),click:R(),contextmenu:R(),move:R(),mousedown:R(),mouseup:R(),spanselect:R(),documentmouseup:R(),pressandwheel:R(),sync_move:R()},g=(u,n,s)=>{const o=j.useRef(s);o.current=s,j.useEffect(()=>h[u].addEventListener(n,(p,r)=>{o.current(r,p)}),[n,u,o])},H=j.createContext(""),de=(u,n)=>{const s=j.useContext(H);return g(u,s,n)},re=(u,n,s,o,v)=>{if(!n)return;const p=o??s.scales.find(I=>I.origin==="x")?.id,r=v??s.scales.find(I=>I.origin==="y")?.id,e=u.clientX-n.left,a=p?{scaleId:p,value:k(s,e,p)}:null,x=u.clientY-n.top,K=r?{scaleId:r,value:k(s,x,r)}:null;return{pointerSyncPosition:{x:a,y:K},cssX:e,cssY:x}},_=(u,n)=>{const{x:s,y:o}=u,v=s&&n.scales.some(r=>r.id===s.scaleId)?D(n,s.value,s.scaleId,"css"):null,p=o&&n.scales.some(r=>r.id===o.scaleId)?D(n,o.value,o.scaleId,"css"):null;return{cssX:v,cssY:p,scaled:Object.fromEntries(n.scales.flatMap(r=>{const e=r.origin==="y"?p:v;return e===null?[]:[[r.id,k(n,e,r.id)]]}))}},te=(u,n,s)=>{const o=D(s,n.from,n.scaleId,"css"),v=D(s,n.to,n.scaleId,"css"),p=s.scales.flatMap(r=>{if(r.origin!==u)return[];const e=k(s,o,r.id),a=k(s,v,r.id);return[{scaleId:r.id,from:e,to:a}]});return{fromCSS:o,toCSS:v,scaled:p}},oe=({id:u,onClick:n,onDblClick:s,onMouseMove:o,onMouseDown:v,onMouseUp:p,onDocumentMouseUp:r,onSpanSelect:e,onContextMenu:a,className:x,style:K,sync:I,innerChildren:M,children:B})=>{const d=w.useId();return g("dblclick",d,l=>{s?.(l)}),g("click",d,l=>{n?.(l)}),g("move",d,l=>{o?.(l)}),g("mousedown",d,l=>{v?.(l)}),g("mouseup",d,l=>{p?.(l)}),g("documentmouseup",d,l=>{r?.(l)}),g("spanselect",d,l=>{e?.(l)}),g("contextmenu",d,l=>{a?.(l)}),q.jsxs(H.Provider,{value:d,children:[q.jsx(ae,{id:u,className:x,style:K,sync:I,children:M}),B]})},ae=({id:u,className:n,style:s,sync:o,children:v})=>{const p=w.useRef(null),r=ce().frame,e=w.useRef(r);e.current=r;const a=w.useContext(H),x=o?.key||a,K=w.useRef(null),I=w.useRef(null),M=w.useRef(null),B=()=>{const t=p.current?.parentElement;if(t){if(t.dataset.canplotroot===void 0)throw new Error("ChartAreaInteractions must be used within a CanPlot component");return t.getBoundingClientRect()}},d=(t,i)=>{const f=re(t,B(),e.current,o?.xViaScaleId,o?.yViaScaleId);f&&i(f.pointerSyncPosition,{cssX:f.cssX,cssY:f.cssY},{ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey})},l=w.useRef(d);return l.current=d,w.useEffect(()=>{const t=c=>{const S=I.current;S&&h.spanselect.dispatchEvent(a,{...S,completed:!0}),h.documentmouseup.dispatchEvent(a,{frame:e.current,keys:{ctrlKey:c.ctrlKey,altKey:c.altKey,shiftKey:c.shiftKey,metaKey:c.metaKey}})},i=c=>{const S={ctrlKey:c.ctrlKey,altKey:c.altKey,shiftKey:c.shiftKey,metaKey:c.metaKey},b=M.current;if(b&&Object.entries(S).some(([E,P])=>b.keys[E]!==P)){const E={...b,keys:S};M.current=E,h.sync_move.dispatchEvent(x,E)}const L=I.current;if(L&&Object.entries(S).some(([E,P])=>L.keys[E]!==P)){c.stopPropagation(),c.preventDefault();const E={...L,keys:S};I.current=E,h.spanselect.dispatchEvent(a,E)}},f=c=>{l.current(c,(S,{cssX:b,cssY:L},E)=>{const P=K.current;if(!P||!S.x||!S.y)return;const C=e.current,O=P.xRangeCss.start,T=b,V=P.yRangeCss.start,U=L,z=Z(C,S.x.scaleId),F=Z(C,S.y.scaleId);K.current={xRangeCss:{start:O,end:T},yRangeCss:{start:V,end:U}};let A="below_threshold";const G=Math.abs(V-U),W=Math.abs(O-T);G<10&&W<10?A="below_threshold":G>30&&W>30?A="box":G>W?A="y":A="x";const J={scaleId:z.id,from:k(C,$(e.current,O,"css"),z.id),to:k(C,$(e.current,T,"css"),z.id)},N={scaleId:F.id,from:k(C,ee(e.current,V,"css"),F.id),to:k(C,ee(e.current,U,"css"),F.id)},X=J&&te("x",J,e.current),Y=N&&te("y",N,e.current),ne=X?.scaled,se=Y?.scaled,Q={mode:A,frame:e.current,completed:!1,x:{css:X&&{from:X.fromCSS,to:X.toCSS},scaled:ne??[]},y:{css:Y&&{from:Y.fromCSS,to:Y.toCSS},scaled:se??[]},keys:E};I.current=Q,h.spanselect.dispatchEvent(a,Q)})},m=c=>{l.current(c,(S,b,L)=>{const E=_(S,e.current);if(!E)return;if(Object.values(L).some(C=>C)){c.preventDefault();const C=Math.abs(c.deltaY)>Math.abs(c.deltaX)?c.deltaY:c.deltaX;h.pressandwheel.dispatchEvent(a,{pointer:E,frame:e.current,keys:L,deltaX:c.deltaX,deltaY:c.deltaY,deltaAbs:C})}})};document.addEventListener("mouseup",t),document.addEventListener("keydown",i),document.addEventListener("keyup",i),document.addEventListener("mousemove",f);const y=p.current;return y?.addEventListener("wheel",m,{passive:!1}),()=>{document.removeEventListener("mouseup",t),document.removeEventListener("keydown",i),document.removeEventListener("keyup",i),document.removeEventListener("mousemove",f),y?.removeEventListener("wheel",m)}},[e,a,x,l]),g("sync_move",x,t=>{const i=t.positions?_(t.positions,e.current):null;M.current=t,h.move.dispatchEvent(a,{frame:e.current,pointer:i??null,keys:t.keys,source:t.originInteractionsId===a?"own":"sync"})}),q.jsx("div",{ref:p,id:u,className:n,style:{position:"absolute",left:r.chartAreaCSS.x,top:r.chartAreaCSS.y,width:r.chartAreaCSS.width,height:r.chartAreaCSS.height,zIndex:25,...s},onDragStart:t=>{t.preventDefault()},onClick:t=>{d(t,(i,f,m)=>{const y=_(i,e.current);y&&h.click.dispatchEvent(a,{pointer:y,frame:e.current,keys:m})})},onMouseLeave:t=>{d(t,(i,f,m)=>{h.sync_move.dispatchEvent(x,{positions:null,keys:m,originInteractionsId:a})})},onMouseMove:t=>{d(t,(i,f,m)=>{h.sync_move.dispatchEvent(x,{positions:i,keys:m,originInteractionsId:a})})},onMouseDown:t=>{d(t,(i,{cssX:f,cssY:m},y)=>{const c=_(i,e.current);c&&(h.mousedown.dispatchEvent(a,{pointer:c,frame:e.current,keys:y}),K.current={xRangeCss:{start:f,end:f},yRangeCss:{start:m,end:m}})})},onMouseUp:t=>{d(t,(i,f,m)=>{const y=_(i,e.current);if(!y)return;h.mouseup.dispatchEvent(a,{frame:e.current,pointer:y,keys:m});const c=I.current;I.current=null;const S=K.current;if(K.current=null,S&&c){const b={...c,keys:m,completed:!0};I.current=null,h.spanselect.dispatchEvent(a,b)}})},onContextMenu:t=>{t.preventDefault(),d(t,(i,f,m)=>{const y=_(i,e.current);y&&h.contextmenu.dispatchEvent(a,{frame:e.current,pointer:y,keys:m})})},onDoubleClick:t=>{d(t,(i,f,m)=>{const y=_(i,e.current);y&&h.dblclick.dispatchEvent(a,{frame:e.current,pointer:y,keys:m})})},children:v})};oe.__docgenInfo={description:"",methods:[],displayName:"ChartAreaInteractions"};export{oe as C,de as u};
