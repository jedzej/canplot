import{j as z}from"./jsx-runtime-D_zvdyIk.js";import{R as X,r as I}from"./iframe-B9ZU6-mP.js";import{f as Y,h as R,a as Z,g as W,c as q,b as H}from"./CanPlot-Cupv9CKr.js";const m=()=>{const r=[];return{addEventListener:(o,c)=>(r.push({syncKey:o,callback:c}),()=>{const i=r.findIndex(p=>p.callback===c);i!==-1&&r.splice(i,1)}),dispatchEvent:(o,c)=>{for(const i of r)i.syncKey===o&&i.callback(o,c)}}},u={dblclick:m(),click:m(),contextmenu:m(),move:m(),mousedown:m(),mouseup:m(),spanselect:m(),documentmouseup:m(),pressandwheel:m(),sync_dblclick:m(),sync_click:m(),sync_move:m(),sync_mousedown:m(),sync_mouseup:m(),sync_spanselect:m(),sync_pressandwheel:m(),sync_contextmenu:m()},f=(r,o,c)=>{const i=X.useRef(c);i.current=c,X.useEffect(()=>u[r].addEventListener(o,(s,l)=>{i.current(l,s)}),[o,r,i])},F=X.createContext(""),oe=(r,o)=>{const c=X.useContext(F);return f(r,c,o)},$=(r,o,c,i,p)=>{if(!o)return;const s=i??c.scales.find(w=>w.origin==="x")?.id,l=p??c.scales.find(w=>w.origin==="y")?.id;if(!s||!l)return;const n=r.clientX-o.left,S={scaleId:s,value:R(c,n,s)},E=r.clientY-o.top,g={scaleId:l,value:R(c,E,l)};return{pointerSyncPosition:{x:S,y:g},cssX:n,cssY:E}},K=(r,o)=>{const c=r.x?Y(o,r.x.value,r.x.scaleId,"css"):0,i=r.y?Y(o,r.y.value,r.y.scaleId,"css"):0;return{cssX:c,cssY:i,scaled:Object.fromEntries(o.scales.map(p=>{const s=p.origin==="y"?i:c;return[p.id,R(o,s,p.id)]}))}},J=(r,o,c)=>{const i=Y(c,o.from,o.scaleId,"css"),p=Y(c,o.to,o.scaleId,"css"),s=c.scales.flatMap(l=>{if(l.origin!==r)return[];const n=R(c,i,l.id),S=R(c,p,l.id);return[{scaleId:l.id,from:n,to:S}]});return{fromCSS:i,toCSS:p,scaled:s}},ee=({id:r,onClick:o,onDblClick:c,onMouseMove:i,onMouseDown:p,onMouseUp:s,onDocumentMouseUp:l,onSpanSelect:n,onContextMenu:S,className:E,style:g,sync:w,children:x})=>{const L=I.useId(),e=r||L;return f("dblclick",e,t=>{c?.(t)}),f("click",e,t=>{o?.(t)}),f("move",e,t=>{i?.(t)}),f("mousedown",e,t=>{p?.(t)}),f("mouseup",e,t=>{s?.(t)}),f("documentmouseup",e,t=>{l?.(t)}),f("spanselect",e,t=>{n?.(t)}),f("contextmenu",e,t=>{S?.(t)}),z.jsxs(F.Provider,{value:e,children:[z.jsx(te,{className:E,style:g,sync:w}),x]})},te=({className:r,style:o,sync:c})=>{const i=I.useRef(null),p=Z(),s=I.useRef(p);s.current=p;const l=I.useContext(F),n=c?.key||l,S=I.useRef(null),E=I.useRef(null),g=I.useRef(null),w=()=>{const e=i.current?.parentElement;if(e){if(e.dataset.canplotroot===void 0)throw new Error("ChartAreaInteractions must be used within a CanPlot component");return e.getBoundingClientRect()}},x=(e,t)=>{const d=$(e,w(),s.current,c?.xViaScaleId,c?.yViaScaleId);d&&t(d.pointerSyncPosition,{cssX:d.cssX,cssY:d.cssY},{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})},L=I.useRef(x);return L.current=x,I.useEffect(()=>{const e=a=>{const h=E.current;h&&u.sync_spanselect.dispatchEvent(n,{...h,completed:!0}),u.documentmouseup.dispatchEvent(n,{frame:s.current,keys:{ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey}})},t=a=>{const h={ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey},M=g.current;if(M&&Object.entries(h).some(([v,k])=>M.keys[v]!==k)){const v={...M,keys:h};g.current=v,u.sync_move.dispatchEvent(n,v)}const b=E.current;if(b&&Object.entries(h).some(([v,k])=>b.keys[v]!==k)){a.stopPropagation(),a.preventDefault();const v={...b,keys:h};E.current=v,u.sync_spanselect.dispatchEvent(n,v)}},d=a=>{L.current(a,(h,{cssX:M,cssY:b},v)=>{const k=S.current;if(!k||!h.x||!h.y)return;const A=s.current,P=k.xRangeCss.start,j=M,D=k.yRangeCss.start,B=b,O=W(A,h.x.scaleId),T=W(A,h.y.scaleId);S.current={xRangeCss:{start:P,end:j},yRangeCss:{start:D,end:B}};let C="below_threshold";const V=Math.abs(D-B),U=Math.abs(P-j);V<10&&U<10?C="below_threshold":V>30&&U>30?C="box":V>U?C="y":C="x";const N=C==="x"||C==="box"?{scaleId:O.id,from:R(A,q(s.current,P,"css"),O.id),to:R(A,q(s.current,j,"css"),O.id)}:void 0,Q=C==="y"||C==="box"?{scaleId:T.id,from:R(A,H(s.current,D,"css"),T.id),to:R(A,H(s.current,B,"css"),T.id)}:void 0,G={mode:C,xRange:N,yRange:Q,completed:!1,keys:v};E.current=G,u.sync_spanselect.dispatchEvent(n,G)})},y=a=>{L.current(a,(h,M,b)=>{if(Object.values(b).some(k=>k)){a.preventDefault();const k=Math.abs(a.deltaY)>Math.abs(a.deltaX)?a.deltaY:a.deltaX;u.sync_pressandwheel.dispatchEvent(n,{positions:h,keys:b,deltaX:a.deltaX,deltaY:a.deltaY,deltaAbs:k})}})};document.addEventListener("mouseup",e),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("mousemove",d);const _=i.current;return _?.addEventListener("wheel",y,{passive:!1}),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("mousemove",d),_?.removeEventListener("wheel",y)}},[s,n,L]),f("sync_dblclick",n,e=>{const t=K(e.positions,s.current);t&&u.dblclick.dispatchEvent(l,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_click",n,e=>{const t=K(e.positions,s.current);t&&u.click.dispatchEvent(l,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_contextmenu",n,e=>{const t=K(e.positions,s.current);t&&u.contextmenu.dispatchEvent(l,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_move",n,e=>{const t=e.positions?K(e.positions,s.current):null;g.current=e,u.move.dispatchEvent(l,{frame:s.current,pointer:t??null,keys:e.keys})}),f("sync_mousedown",n,e=>{const t=K(e.positions,s.current);t&&u.mousedown.dispatchEvent(l,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_mouseup",n,e=>{const t=K(e.positions,s.current);t&&u.mouseup.dispatchEvent(l,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_pressandwheel",n,e=>{const t=K(e.positions,s.current);t&&u.pressandwheel.dispatchEvent(l,{frame:s.current,pointer:t,keys:e.keys,deltaX:e.deltaX,deltaY:e.deltaY,deltaAbs:e.deltaAbs})}),f("sync_spanselect",n,e=>{const t=e.xRange&&J("x",e.xRange,s.current),d=e.yRange&&J("y",e.yRange,s.current),y=t?.scaled,_=d?.scaled;e.completed&&(S.current=null),u.spanselect.dispatchEvent(l,{mode:e.mode,frame:s.current,completed:e.completed,x:{css:t&&{from:t.fromCSS,to:t.toCSS},scaled:y??[]},y:{css:d&&{from:d.fromCSS,to:d.toCSS},scaled:_??[]},keys:e.keys})}),z.jsx("div",{ref:i,id:"interactions",className:r,style:{position:"absolute",left:p.chartAreaCSS.x,top:p.chartAreaCSS.y,width:p.chartAreaCSS.width,height:p.chartAreaCSS.height,zIndex:25,...o},onDragStart:e=>{e.preventDefault()},onClick:e=>{x(e,(t,d,y)=>{u.sync_click.dispatchEvent(n,{positions:t,keys:y})})},onMouseLeave:e=>{x(e,(t,d,y)=>{u.sync_move.dispatchEvent(n,{positions:null,keys:y})})},onMouseMove:e=>{x(e,(t,d,y)=>{u.sync_move.dispatchEvent(n,{positions:t,keys:y})})},onMouseDown:e=>{x(e,(t,{cssX:d,cssY:y},_)=>{u.sync_mousedown.dispatchEvent(n,{positions:t,keys:_}),E.current=null,S.current={xRangeCss:{start:d,end:d},yRangeCss:{start:y,end:y}}})},onMouseUp:e=>{x(e,(t,d,y)=>{u.sync_mouseup.dispatchEvent(n,{positions:t,keys:y});const _=E.current;E.current=null;const a=S.current;if(S.current=null,a&&_){const h={..._,keys:y,completed:!0};u.sync_spanselect.dispatchEvent(n,h)}})},onContextMenu:e=>{e.preventDefault(),x(e,(t,d,y)=>{u.sync_contextmenu.dispatchEvent(n,{positions:t,keys:y})})},onDoubleClick:e=>{x(e,(t,d,y)=>{u.sync_dblclick.dispatchEvent(n,{positions:t,keys:y})})}})};ee.__docgenInfo={description:"",methods:[],displayName:"ChartAreaInteractions"};export{ee as C,oe as u};
