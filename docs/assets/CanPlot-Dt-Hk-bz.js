import{j as g}from"./jsx-runtime-D_zvdyIk.js";import{R as y,r as u}from"./iframe-C_5h61o-.js";const S=(e,t,a)=>Math.min(Math.max(e,t),a),$=(e,t,a,i)=>{const{min:n,max:s,origin:r}=p(e,a),l=e.chartAreaCanvasPX,c=(r==="x"?l.width:l.height)/(s-n);return t/c},p=(e,t)=>{const a=e.scales.find(i=>i.id===t);if(!a)throw new Error(`Scale ${t} not found`);return a},_=(e,t)=>{const a=window.devicePixelRatio||1;e.lineCap=t?.lineCap??"butt",e.lineDashOffset=a*(t?.lineDashOffset??0),e.lineJoin=t?.lineJoin??"miter",e.lineWidth=a*(t?.lineWidth??1),e.miterLimit=a*(t?.miterLimit??10),e.strokeStyle=t?.strokeStyle??"black",e.fillStyle=t?.fillStyle??e.strokeStyle,e.font=t?.font??`${10*a}px sans-serif`,e.textAlign=t?.textAlign??"start",e.direction=t?.direction??"inherit",e.textBaseline=t?.textBaseline??"alphabetic",e.fontKerning=t?.fontKerning??"auto"},P=(e,t,a,i)=>{const n=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,{min:s,max:r,origin:l}=p(e,a),c=(l==="x"?n.width:n.height)/(r-s);return t*c},q=(e,t,a,i)=>{const{min:n,origin:s}=p(e,a),r=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,l=P(e,t-n,a,i);return s==="x"?S(r.x+l,r.x-10*r.width,r.x+11*r.width):S(r.y+r.height-l,r.y-10*r.height,r.y+11*r.height)},D=(e,t,a)=>{const i=a==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return S(t,i.x,i.x+i.width)},O=(e,t,a)=>{const i=a==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return S(t,i.y,i.y+i.height)},F=(e,t,a)=>{const{min:i,max:n}=p(e,a);return t>=i&&t<=n},V=(e,t,a,i)=>{const{min:n,max:s,origin:r}=p(e,a),l=e.chartAreaCSS,c=r==="x"?(t-l.x)/l.width:(l.height-t+l.y)/l.height;return n+c*(s-n)},E=e=>{const{ctx:t,scales:a}=e;for(const i of a){if(!i.axis)continue;t.save(),_(t,{strokeStyle:"black",fillStyle:"black",lineWidth:1,...i.axis.style});const n=i.axis.canvasRect;if(i.origin==="x"){if(i.axis.position==="bottom")t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.x+n.width,n.y),t.stroke();else if(i.axis.position==="top"){const s=n.y+n.height;t.beginPath(),t.moveTo(n.x,s),t.lineTo(n.x+n.width,s),t.stroke()}}else if(i.axis.position==="left"){const s=n.x+n.width;t.beginPath(),t.moveTo(s,n.y),t.lineTo(s,n.y+n.height),t.stroke()}else i.axis.position==="right"&&(t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.x,n.y+n.height),t.stroke());t.restore()}},C=e=>{let t;const a=new Set,i=(m,x)=>{const h=typeof m=="function"?m(t):m;if(!Object.is(h,t)){const f=t;t=x??(typeof h!="object"||h===null)?h:Object.assign({},t,h),a.forEach(o=>o(t,f))}},n=()=>t,l={setState:i,getState:n,getInitialState:()=>c,subscribe:m=>(a.add(m),()=>a.delete(m))},c=t=e(i,n,l);return l},k=(e=>e?C(e):C),L=e=>e;function R(e,t=L){const a=y.useSyncExternalStore(e.subscribe,y.useCallback(()=>t(e.getState()),[e,t]),y.useCallback(()=>t(e.getInitialState()),[e,t]));return y.useDebugValue(a),a}const v={TOP:400,MIDDLE:300,BOTTOM:200,BACKGROUND:100},z=()=>k((e,t)=>{const a=()=>{const i=t()._frame;if(!i)throw new Error("No frame set in frame store");return i};return{_frame:null,getFrame:a,getCtx:()=>a().ctx,clampXPosToChartArea:(i,n)=>D(a(),i,n??"canvas"),clampYPosToChartArea:(i,n)=>O(a(),i,n??"canvas"),valToPos:(i,n,s)=>q(a(),i,n,s??"canvas"),valToPxDistance:(i,n,s)=>P(a(),i,n,s??"canvas"),valFits:(i,n)=>F(a(),i,n),getScale:i=>p(a(),i),_listeners:[],_subscribe:(i,n)=>(t()._listeners.push([n,i]),t()._listeners.sort((s,r)=>s[0]-r[0]),()=>{const s=t()._listeners.findIndex(([,r])=>r===i);s!==-1&&t()._listeners.splice(s,1)}),_notifyListeners:i=>{for(const[,n]of t()._listeners)n(i)}}}),j=()=>k(e=>({notify:()=>{e(t=>({version:t.version+1}))},version:0})),b=u.createContext(null),A=u.createContext(null),Y=(e,t,a)=>{const i=u.useContext(b),n=u.useContext(A);if(!i||!n)throw new Error("useFrame must be used within a CanPlot component");const s=u.useRef(t);s.current=t,u.useLayoutEffect(()=>(Promise.resolve().then(()=>{s.current(i.getState())}),i.getState()._subscribe(r=>{r._frame&&s.current(r)},typeof e=="number"?e:v[e])),[i,e]),u.useEffect(()=>{n.getState().notify()},[n,...a])},G=e=>{const t=u.useContext(b);if(!t)throw new Error("useFrame must be used within a CanPlot component");return R(t,e??(a=>a.getFrame()))};function M(e){return t=>{for(const a of e)w(a,t)}}function W(e){return t=>{const a=[];for(const i of e){const n=w(i,t),s=typeof n=="function";a.push(s?n:()=>w(i,null))}return()=>{for(const i of a)i()}}}function w(e,t){if(typeof e=="function")return e(t);e&&(e.current=t)}var I=parseInt(u.version.split(".")[0],10)>=19?W:M;const X=u.forwardRef(({configuration:e,children:t,style:a,className:i},n)=>{const s=u.useRef(null),r=u.useRef(null),l=J(r),c=u.useMemo(z,[]),m=u.useMemo(j,[]);u.useLayoutEffect(()=>{c.setState({_frame:N(e,l,s.current)});const h=c.getState();h._notifyListeners(h)},[e,l,s,c]),u.useLayoutEffect(()=>c.getState()._subscribe(h=>{const f=h._frame?.ctx;f&&f.clearRect(0,0,f.canvas.width,f.canvas.height)},v.BACKGROUND),[c]),u.useLayoutEffect(()=>c.getState()._subscribe(h=>{h._frame&&E(h._frame)},v.BOTTOM),[c]),u.useLayoutEffect(()=>{let h=!1;return m.subscribe(()=>{h||(h=!0,window.requestAnimationFrame(()=>{h=!1,c.setState(o=>({_frame:o._frame?{...o._frame}:null}));const f=c.getState();f._notifyListeners(f)}))})},[m,c]);const x=window.devicePixelRatio||1;return g.jsxs("div",{ref:I([n,r]),className:i,style:{position:"relative",overflow:"hidden",...a},"data-canplotroot":!0,children:[g.jsx("canvas",{ref:s,width:l.width*x,height:l.height*x,style:{inset:0,position:"absolute",width:`${l.width}px`,height:`${l.height}px`}}),g.jsx(B,{frameStore:c,updateRequestStore:m,children:t})]})}),B=({frameStore:e,updateRequestStore:t,children:a})=>R(e,n=>!!n._frame)?g.jsx(A.Provider,{value:t,children:g.jsx(b.Provider,{value:e,children:a})}):null,J=e=>{const[t,a]=u.useState({width:0,height:0}),[i]=u.useState(()=>new ResizeObserver(n=>{for(const s of n){const r=Math.round(s.contentRect.width),l=Math.round(s.contentRect.height);a(c=>c.width!==r||c.height!==l?{...c,width:r,height:l}:c)}}));return u.useLayoutEffect(()=>{if(!e.current)return;const n=e.current.clientWidth,s=e.current.clientHeight;return a(r=>r.width!==n||r.height!==s?{...r,width:n,height:s}:r),i.observe(e.current,{box:"border-box"}),()=>i.disconnect()},[i,e]),t},N=(e,t,a)=>{const i=a?.getContext("2d");if(!i)return null;const n=window.devicePixelRatio||1;if(t.width===0||t.height===0)return null;const s={x:e.padding.left,y:e.padding.top,width:t.width-e.padding.left-e.padding.right,height:t.height-e.padding.top-e.padding.bottom};for(const o of e.scales)o.axis&&(o.origin==="x"?(o.axis.position==="bottom"||o.axis.position==="top")&&(s.height=Math.max(0,s.height-o.axis.size),o.axis.position==="top"&&(s.y+=o.axis.size)):(o.axis.position==="left"||o.axis.position==="right")&&(s.width=Math.max(0,s.width-o.axis.size),o.axis.position==="left"&&(s.x+=o.axis.size)));const r={x:s.x*n,y:s.y*n,width:s.width*n,height:s.height*n},l=[];let c=e.padding.left*n,m=i.canvas.width-e.padding.right*n,x=i.canvas.height-e.padding.bottom*n,h=e.padding.top*n;for(const o of e.scales){if(!o.axis){l.push({...o,axis:null});continue}let d;if(o.origin==="x")switch(o.axis.position){case"bottom":x-=o.axis.size*n,d={x:s.x,y:x/n,width:s.width,height:o.axis.size};break;case"top":h+=o.axis.size*n,d={x:s.x,y:h/n-o.axis.size,width:s.width,height:o.axis.size};break;case"left":case"right":throw new Error("Invalid axis position for x origin")}else switch(o.axis.position){case"left":c+=o.axis.size*n,d={x:c/n-o.axis.size,y:s.y,width:o.axis.size,height:s.height};break;case"right":m-=o.axis.size*n,d={x:m/n,y:s.y,width:o.axis.size,height:s.height};break;case"top":case"bottom":throw new Error("Invalid axis position for y origin")}const T={x:d.x*n,y:d.y*n,width:d.width*n,height:d.height*n};l.push({...o,axis:{...o.axis,cssRect:d,canvasRect:T}})}return{ctx:i,dpr:n,padding:e.padding,scales:l,chartAreaCSS:s,chartAreaCanvasPX:r}};X.__docgenInfo={description:"",methods:[],displayName:"CanPlot",props:{configuration:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  padding: PlotPadding;
  scales: PlotScaleConfig[];
}`,signature:{properties:[{key:"padding",value:{name:"signature",type:"object",raw:`{
  top: number;
  bottom: number;
  left: number;
  right: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"bottom",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}},{key:"right",value:{name:"number",required:!0}}]},required:!0}},{key:"scales",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  min: number;
  max: number;
  origin: "x" | "y";
  axis: null | PlotAxis;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"min",value:{name:"number",required:!0}},{key:"max",value:{name:"number",required:!0}},{key:"origin",value:{name:"union",raw:'"x" | "y"',elements:[{name:"literal",value:'"x"'},{name:"literal",value:'"y"'}],required:!0}},{key:"axis",value:{name:"union",raw:"null | PlotAxis",elements:[{name:"null"},{name:"signature",type:"object",raw:`{
  position: "left" | "right" | "top" | "bottom";
  size: number;
  style?: Style;
}`,signature:{properties:[{key:"position",value:{name:"union",raw:'"left" | "right" | "top" | "bottom"',elements:[{name:"literal",value:'"left"'},{name:"literal",value:'"right"'},{name:"literal",value:'"top"'},{name:"literal",value:'"bottom"'}],required:!0}},{key:"size",value:{name:"number",required:!0}},{key:"style",value:{name:"intersection",raw:`{
  fillStyle?: CanvasFillStrokeStyles["fillStyle"];
  strokeStyle?: CanvasFillStrokeStyles["strokeStyle"];
} & Partial<
  Pick<
    CanvasPathDrawingStyles,
    "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
  >
> &
  Partial<CanvasTextDrawingStyles>`,elements:[{name:"signature",type:"object",raw:`{
  fillStyle?: CanvasFillStrokeStyles["fillStyle"];
  strokeStyle?: CanvasFillStrokeStyles["strokeStyle"];
}`,signature:{properties:[{key:"fillStyle",value:{name:'CanvasFillStrokeStyles["fillStyle"]',raw:'CanvasFillStrokeStyles["fillStyle"]',required:!1}},{key:"strokeStyle",value:{name:'CanvasFillStrokeStyles["strokeStyle"]',raw:'CanvasFillStrokeStyles["strokeStyle"]',required:!1}}]}},{name:"Partial",elements:[{name:"Pick",elements:[{name:"CanvasPathDrawingStyles"},{name:"union",raw:'"lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"',elements:[{name:"literal",value:'"lineCap"'},{name:"literal",value:'"lineDashOffset"'},{name:"literal",value:'"lineJoin"'},{name:"literal",value:'"lineWidth"'},{name:"literal",value:'"miterLimit"'}]}],raw:`Pick<
  CanvasPathDrawingStyles,
  "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
>`}],raw:`Partial<
  Pick<
    CanvasPathDrawingStyles,
    "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
  >
>`},{name:"Partial",elements:[{name:"CanvasTextDrawingStyles"}],raw:"Partial<CanvasTextDrawingStyles>"}],required:!1}}]}}],required:!0}}]}}],raw:"PlotScaleConfig[]",required:!0}}]}},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};export{X as C,v as a,_ as b,G as c,D as d,O as e,P as f,q as g,p as h,V as i,$ as p,Y as u,F as v};
