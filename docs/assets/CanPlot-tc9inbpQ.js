import{j as U}from"./jsx-runtime-D_zvdyIk.js";import{R as A,r as f}from"./iframe-CpxcZYpa.js";const B=5,V=10,G=60,ie=30,K="UTC",oe="en-GB",q=(e,t,n)=>Math.min(Math.max(e,t),n),ae=(e,t,n,i)=>{const{min:o,max:s}=v(e,n),a=e.chartAreaCanvasPX,l=(C(e,n)?a.width:a.height)/(s-o);return t/l},v=(e,t)=>{const n=e.scales.find(i=>i.id===t);if(!n)throw new Error(`Scale ${t} not found`);return n},C=(e,t)=>e.scales.find(n=>n.id===t)?.origin==="x",z=(e,t)=>{const n=window.devicePixelRatio||1;e.lineCap=t?.lineCap??"butt",e.lineDashOffset=n*(t?.lineDashOffset??0),e.lineJoin=t?.lineJoin??"miter",e.lineWidth=n*(t?.lineWidth??1),e.miterLimit=n*(t?.miterLimit??10),e.strokeStyle=t?.strokeStyle??"black",e.fillStyle=t?.fillStyle??e.strokeStyle,e.font=t?.font??`${10*n}px sans-serif`,e.textAlign=t?.textAlign??"start",e.direction=t?.direction??"inherit",e.textBaseline=t?.textBaseline??"alphabetic",e.fontKerning=t?.fontKerning??"auto"},Y=(e,t,n,i)=>{const o=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,{min:s,max:a}=v(e,n),l=(C(e,n)?o.width:o.height)/(a-s);return t*l},k=(e,t,n,i)=>{const{min:o}=v(e,n),s=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,a=Y(e,t-o,n,i);return C(e,n)?q(s.x+a,s.x-10*s.width,s.x+11*s.width):q(s.y+s.height-a,s.y-10*s.height,s.y+11*s.height)},re=(e,t,n)=>{const i=n==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return q(t,i.x,i.x+i.width)},ce=(e,t,n)=>{const i=n==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return q(t,i.y,i.y+i.height)},le=(e,t,n)=>{const{min:i,max:o}=v(e,n);return t>=i&&t<=o},je=(e,t,n,i)=>{const{min:o,max:s}=v(e,n),a=e.chartAreaCSS,l=C(e,n)?(t-a.x)/a.width:(a.height-t+a.y)/a.height;return o+l*(s-o)},ue=1,I=1e3*ue,j=60*I,E=60*j,L=24*E,he=30*L,me=365*L,de=[[1,"milliseconds"],[2,"milliseconds"],[5,"milliseconds"],[10,"milliseconds"],[20,"milliseconds"],[50,"milliseconds"],[100,"milliseconds"],[200,"milliseconds"],[500,"milliseconds"],[1,"seconds"],[5,"seconds"],[10,"seconds"],[15,"seconds"],[30,"seconds"],[1,"minutes"],[5,"minutes"],[10,"minutes"],[15,"minutes"],[30,"minutes"],[1,"hours"],[2,"hours"],[3,"hours"],[4,"hours"],[6,"hours"],[8,"hours"],[12,"hours"],[1,"days"],[3,"days"],[5,"days"],[7,"days"],[10,"days"],[15,"days"],[1,"months"],[2,"months"],[3,"months"],[4,"months"],[6,"months"],[1,"years"],[2,"years"],[5,"years"],[10,"years"],[25,"years"],[50,"years"],[100,"years"]],M=e=>{const[t,n]=e;switch(n){case"milliseconds":return t;case"seconds":return t*I;case"minutes":return t*j;case"hours":return t*E;case"days":return t*L;case"months":return t*he;case"years":return t*me}},ge=(e,t)=>{const n=new Date(e);return n.setUTCMilliseconds(n.getUTCMilliseconds()+t),n.getTime()},pe=(e,t)=>{const n=new Date(e);return n.setUTCSeconds(n.getUTCSeconds()+t),n.getTime()},fe=(e,t)=>{const n=new Date(e);return n.setUTCMinutes(n.getUTCMinutes()+t),n.getTime()},xe=(e,t)=>{const n=new Date(e);return n.setUTCHours(n.getUTCHours()+t),n.getTime()},ye=(e,t)=>{const n=new Date(e);return n.setUTCDate(n.getUTCDate()+t),n.getTime()},X=(e,t)=>{const n=new Date(e);return n.setUTCMonth(n.getUTCMonth()+t),n.getTime()},T=(e,t)=>{const[n,i]=t;switch(i){case"milliseconds":return ge(e,n);case"seconds":return pe(e,n);case"minutes":return fe(e,n);case"hours":return xe(e,n);case"days":return ye(e,n);case"months":return X(e,n);case"years":return X(e,n*12)}};function D(e,t){const n=new Date(e),i=new Date(n.toLocaleString("en-US",{timeZone:t})),o=new Date(n.toLocaleString("en-US",{timeZone:"UTC"}));return(i.getTime()-o.getTime())/(3600*1e3)}const we=(e,t,n="UTC")=>{const[i,o]=t;let s=new Date(e);const a=()=>{s.setUTCHours(-D(s,n),0,0,0)};switch(o){case"milliseconds":s.setUTCMilliseconds(Math.ceil(s.getUTCMilliseconds()/i)*i);break;case"seconds":s.setUTCSeconds(Math.ceil(s.getUTCSeconds()/i)*i,0);break;case"minutes":s.setUTCMinutes(Math.ceil(s.getTime()%E/j/i)*i,0,0);break;case"hours":s.setUTCHours(Math.ceil(s.getTime()%L/E/i)*i,0,0,0);break;case"days":case"months":case"years":o==="months"?s.setUTCDate(1):o==="years"&&s.setUTCMonth(0,1),a(),s.getTime()<e&&(s=new Date(T(s,[1,o])));break}return s.getTime()},Te=({timeZone:e=K,space:t=G})=>({frame:n,scaleId:i})=>{const{min:o,max:s}=v(n,i),a=Math.floor(n.chartAreaCanvasPX.width/t)+1,d=(s-o)/a,[r,h]=de.find(p=>M(p)>=d)??[1,"milliseconds"],g=we(o,[r,h],e),m=D(g,e),c=[g];let u;for(;;){switch(h){case"milliseconds":case"seconds":case"minutes":case"hours":{u=T(g,[c.length*r,h]);break}case"days":{const p=T(g,[c.length*r,h]);u=T(p,[m-D(p,e),"hours"]);break}case"months":case"years":{const p=T(T(T(g,[m,"hours"]),[c.length*r,h]),[-m,"hours"]);u=T(p,[m-D(p,e),"hours"]);break}}if(u>s)break;c.push(u)}return c},w=(e,t,n)=>e.find(i=>i.type===n)?.value!==t.find(i=>i.type===n)?.value,ve=({timeZone:e=K,locale:t=oe,showTimezone:n=!0})=>{const i=new Intl.DateTimeFormat(t,{year:"numeric",day:"numeric",month:"short",hour:"numeric",hourCycle:"h23",minute:"numeric",second:"numeric",fractionalSecondDigits:3,timeZoneName:"short",timeZone:e});return({ticks:o})=>{const s=o[1]-o[0],a=s<M([1,"days"]),l=s<M([1,"minutes"]),d=s<M([1,"seconds"]);return o.map(r=>i.formatToParts(new Date(r))).map((r,h,g)=>{const m=g[h-1],c=h===0||w(r,m,"year"),u=h===0||w(r,m,"day"),p=h===0||w(r,m,"month"),b=h===0||w(r,m,"hour"),x=h===0||w(r,m,"timeZoneName"),J=h===0||w(r,m,"minute"),Q=h===0||w(r,m,"second"),ee=h===0||w(r,m,"fractionalSecond"),P=[];if(a&&(b||J||x||Q||ee)){const y=r.find(S=>S.type==="hour")?.value,te=r.find(S=>S.type==="minute")?.value,ne=r.find(S=>S.type==="timeZoneName")?.value;let N="";if(l){const S=r.find(_=>_.type==="second")?.value,se=r.find(_=>_.type==="fractionalSecond")?.value;N=`:${S}`+(d?`.${se}`:"")}P.push(`${y}:${te}${N}`+(n&&x?` ${ne}`:""))}return(u||p)&&P.push([r.find(y=>y.type==="month")?.value,u&&r.find(y=>y.type==="day")?.value].filter(Boolean).join(" ")),c&&P.push(r.find(y=>y.type==="year")?.value),P.filter(y=>y).join(`
`)})}},R=[];for(let e=-12;e<=12;e++)R.push(1*10**e),R.push(2*10**e),R.push(5*10**e);const be=e=>{const{ctx:t,scales:n}=e;t.save(),t.strokeStyle="black",t.fillStyle="black",t.lineWidth=1,t.font="12px Arial",t.textAlign="center",t.textBaseline="middle";for(const i of n){if(!i.axis)continue;const o=i.type==="time"?Te({space:i.axis.tickSpace,timeZone:i.timeZone}):Se({space:i.axis.tickSpace}),s=i.type==="time"?ve({timeZone:i.timeZone,showTimezone:i.axis.showTimezone,locale:i.locale}):ke,a=i.axis.canvasRect;if(i.origin==="x"){if(i.axis.position==="bottom")t.beginPath(),t.moveTo(a.x,a.y),t.lineTo(a.x+a.width,a.y),t.stroke(),Z(e,i.id,a.y,o,s);else if(i.axis.position==="top"){const l=a.y+a.height;t.beginPath(),t.moveTo(a.x,l),t.lineTo(a.x+a.width,l),t.stroke(),Z(e,i.id,l,o,s)}}else if(i.axis.position==="left"){const l=a.x+a.width;t.beginPath(),t.moveTo(l,a.y),t.lineTo(l,a.y+a.height),t.stroke(),$(e,i.id,l,o,s)}else i.axis.position==="right"&&(t.beginPath(),t.moveTo(a.x,a.y),t.lineTo(a.x,a.y+a.height),t.stroke(),$(e,i.id,a.x,o,s))}t.restore()},$=(e,t,n,i,o)=>{const{ctx:s}=e,a=e.scales.find(u=>u.id===t)?.axis;if(!a)return;const l=window.devicePixelRatio||1,d=B,r=n,h=a.position==="left"?n-d:n+d,g=V*l,m=i({frame:e,scaleId:t})??[],c=o({frame:e,scaleId:t,ticks:m});s.save(),s.fontKerning="auto",z(s,{}),s.beginPath();for(let u=0;u<m.length;u++){const p=k(e,m[u],t,"canvas");s.moveTo(r,p),s.lineTo(h,p)}s.stroke(),s.restore(),s.save(),z(s,{textBaseline:"middle",textAlign:a.position==="left"?"right":"left"});for(let u=0;u<m.length;u++){const p=k(e,m[u],t,"canvas"),b=c[u].split(`
`);for(let x=0;x<b.length;x++)s.fillText(` ${b[x]} `,h,p+x*g)}s.restore()},Z=(e,t,n,i,o)=>{const{ctx:s}=e,a=e.scales.find(u=>u.id===t)?.axis;if(!a)return;const l=window.devicePixelRatio||1,d=B,r=n,h=a.position==="top"?n-d:n+d,g=V*l,m=i({frame:e,scaleId:t})??[],c=o({frame:e,scaleId:t,ticks:m});s.save(),s.fontKerning="auto",z(s,{}),s.beginPath();for(let u=0;u<m.length;u++){const p=k(e,m[u],t,"canvas");s.moveTo(p,r),s.lineTo(p,h)}s.stroke(),s.restore(),s.save(),z(s,{textBaseline:a.position==="top"?"bottom":"top",textAlign:"center"});for(let u=0;u<m.length;u++){const p=k(e,m[u],t,"canvas"),b=c[u].split(`
`);for(let x=0;x<b.length;x++)s.fillText(b[x],p,h+l*2+x*g)}s.restore()},Se=({space:e}={})=>({frame:t,scaleId:n})=>{const{min:i,max:o}=v(t,n),s=[],a=window.devicePixelRatio||1,l=(e??(C(t,n)?G:ie))*a,d=ae(t,l,n),r=R.find(g=>g>d)??1;let h=i%r<Number.EPSILON?i:i+r-i%r;for(;h<=o;)s.push(h),h+=r;return s},ke=({ticks:e})=>{const t=Math.max(0,Math.ceil(-Math.log10(e[1]-e[0])));return e.map(n=>n.toFixed(t))},H=e=>{let t;const n=new Set,i=(r,h)=>{const g=typeof r=="function"?r(t):r;if(!Object.is(g,t)){const m=t;t=h??(typeof g!="object"||g===null)?g:Object.assign({},t,g),n.forEach(c=>c(t,m))}},o=()=>t,l={setState:i,getState:o,getInitialState:()=>d,subscribe:r=>(n.add(r),()=>n.delete(r))},d=t=e(i,o,l);return l},Ce=(e=>e?H(e):H),Pe=e=>e;function W(e,t=Pe){const n=A.useSyncExternalStore(e.subscribe,A.useCallback(()=>t(e.getState()),[e,t]),A.useCallback(()=>t(e.getInitialState()),[e,t]));return A.useDebugValue(n),n}const Ae=()=>Ce((e,t)=>{const n=()=>{const i=t()._frame;if(!i)throw new Error("No frame set in frame store");return i};return{_frame:null,getFrame:n,getCtx:()=>n().ctx,clampXPosToChartArea:(i,o)=>re(n(),i,o??"canvas"),clampYPosToChartArea:(i,o)=>ce(n(),i,o??"canvas"),valToPos:(i,o,s)=>k(n(),i,o,s??"canvas"),valToPxDistance:(i,o,s)=>Y(n(),i,o,s??"canvas"),valFits:(i,o)=>le(n(),i,o),getScale:i=>v(n(),i)}}),O=f.createContext(null),Oe=(e,t)=>{const n=f.useContext(O);if(!n)throw new Error("useFrame must be used within a CanPlot component");const i=f.useRef(e);i.current=e,f.useLayoutEffect(()=>{i.current(n.getState()),n.subscribe(o=>{o._frame&&i.current(o)})},[n,...t])},Ne=e=>{const t=f.useContext(O);if(!t)throw new Error("useFrame must be used within a CanPlot component");return W(t,e??(n=>n.getFrame()))};function Ue(e){return t=>{for(const n of e)F(n,t)}}function Me(e){return t=>{const n=[];for(const i of e){const o=F(i,t),s=typeof o=="function";n.push(s?o:()=>F(i,null))}return()=>{for(const i of n)i()}}}function F(e,t){if(typeof e=="function")return e(t);e&&(e.current=t)}var De=parseInt(f.version.split(".")[0],10)>=19?Me:Ue;const Re=f.forwardRef(({configuration:e,children:t,style:n,className:i},o)=>{const s=f.useRef(null),a=f.useRef(null),l=ze(a),d=f.useMemo(Ae,[]);f.useLayoutEffect(()=>{d.setState({_frame:Ee(e,l,s.current)})},[e,l,s,d]),f.useLayoutEffect(()=>d.subscribe(h=>{h._frame&&Le(h._frame)}),[d]);const r=window.devicePixelRatio||1;return U.jsxs("div",{ref:De([o,a]),className:i,style:{position:"relative",overflow:"hidden",...n},"data-canplotroot":!0,children:[U.jsx("canvas",{ref:s,width:l.width*r,height:l.height*r,style:{inset:0,position:"absolute",width:`${l.width}px`,height:`${l.height}px`}}),U.jsx(qe,{frameStore:d,children:t})]})}),qe=({frameStore:e,children:t})=>W(e,i=>!!i._frame)?U.jsx(O.Provider,{value:e,children:t}):null,ze=e=>{const[t,n]=f.useState({width:0,height:0}),[i]=f.useState(()=>new ResizeObserver(o=>{for(const s of o){const a=Math.round(s.contentRect.width),l=Math.round(s.contentRect.height);n(d=>d.width!==a||d.height!==l?{...d,width:a,height:l}:d)}}));return f.useLayoutEffect(()=>{if(!e.current)return;const o=e.current.clientWidth,s=e.current.clientHeight;return n(a=>a.width!==o||a.height!==s?{...a,width:o,height:s}:a),i.observe(e.current,{box:"border-box"}),()=>i.disconnect()},[i,e]),t},Ee=(e,t,n)=>{const i=n?.getContext("2d");if(!i)return null;const o=window.devicePixelRatio||1;if(t.width===0||t.height===0)return null;const s={x:e.padding.left,y:e.padding.top,width:t.width-e.padding.left-e.padding.right,height:t.height-e.padding.top-e.padding.bottom};for(const c of e.scales)c.axis&&(c.origin==="x"?(c.axis.position==="bottom"||c.axis.position==="top")&&(s.height=Math.max(0,s.height-c.axis.size),c.axis.position==="top"&&(s.y+=c.axis.size)):(c.axis.position==="left"||c.axis.position==="right")&&(s.width=Math.max(0,s.width-c.axis.size),c.axis.position==="left"&&(s.x+=c.axis.size)));const a={x:s.x*o,y:s.y*o,width:s.width*o,height:s.height*o},l=[];let d=e.padding.left*o,r=i.canvas.width-e.padding.right*o,h=i.canvas.height-e.padding.bottom*o,g=e.padding.top*o;for(const c of e.scales){if(!c.axis){l.push({...c,axis:null});continue}let u;if(c.origin==="x")switch(c.axis.position){case"bottom":h-=c.axis.size*o,u={x:s.x,y:h/o,width:s.width,height:c.axis.size};break;case"top":g+=c.axis.size*o,u={x:s.x,y:g/o-c.axis.size,width:s.width,height:c.axis.size};break;case"left":case"right":throw new Error("Invalid axis position for x origin")}else switch(c.axis.position){case"left":d+=c.axis.size*o,u={x:d/o-c.axis.size,y:s.y,width:c.axis.size,height:s.height};break;case"right":r-=c.axis.size*o,u={x:r/o,y:s.y,width:c.axis.size,height:s.height};break;case"top":case"bottom":throw new Error("Invalid axis position for y origin")}const p={x:u.x*o,y:u.y*o,width:u.width*o,height:u.height*o};l.push({...c,axis:{...c.axis,cssRect:u,canvasRect:p}})}return{ctx:i,dpr:o,padding:e.padding,scales:l,chartAreaCSS:s,chartAreaCanvasPX:a}},Le=e=>{e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),be(e)};Re.__docgenInfo={description:"",methods:[],displayName:"CanPlot",props:{configuration:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  padding: PlotPadding;
  scales: PlotScaleConfig[];
}`,signature:{properties:[{key:"padding",value:{name:"signature",type:"object",raw:`{
  top: number;
  bottom: number;
  left: number;
  right: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"bottom",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}},{key:"right",value:{name:"number",required:!0}}]},required:!0}},{key:"scales",value:{name:"Array",elements:[{name:"union",raw:"PlotScaleLinearConfig | PlotScaleTimeConfig",elements:[{name:"signature",type:"object",raw:`{
  type: "linear";
  id: string;
  min: number;
  max: number;
  origin: "x" | "y";
  axis: null | PlotAxisLinear;
}`,signature:{properties:[{key:"type",value:{name:"literal",value:'"linear"',required:!0}},{key:"id",value:{name:"string",required:!0}},{key:"min",value:{name:"number",required:!0}},{key:"max",value:{name:"number",required:!0}},{key:"origin",value:{name:"union",raw:'"x" | "y"',elements:[{name:"literal",value:'"x"'},{name:"literal",value:'"y"'}],required:!0}},{key:"axis",value:{name:"union",raw:"null | PlotAxisLinear",elements:[{name:"null"},{name:"signature",type:"object",raw:`{
  position: "left" | "right" | "top" | "bottom";
  size: number;
  tickSpace?: number;
}`,signature:{properties:[{key:"position",value:{name:"union",raw:'"left" | "right" | "top" | "bottom"',elements:[{name:"literal",value:'"left"'},{name:"literal",value:'"right"'},{name:"literal",value:'"top"'},{name:"literal",value:'"bottom"'}],required:!0}},{key:"size",value:{name:"number",required:!0}},{key:"tickSpace",value:{name:"number",required:!1}}]}}],required:!0}}]}},{name:"signature",type:"object",raw:`{
  type: "time";
  id: string;
  min: number;
  max: number;
  origin: "x" | "y";
  axis: null | PlotAxisTime;
  timeZone: string;
  locale?: string;
}`,signature:{properties:[{key:"type",value:{name:"literal",value:'"time"',required:!0}},{key:"id",value:{name:"string",required:!0}},{key:"min",value:{name:"number",required:!0}},{key:"max",value:{name:"number",required:!0}},{key:"origin",value:{name:"union",raw:'"x" | "y"',elements:[{name:"literal",value:'"x"'},{name:"literal",value:'"y"'}],required:!0}},{key:"axis",value:{name:"union",raw:"null | PlotAxisTime",elements:[{name:"null"},{name:"signature",type:"object",raw:`{
  position: "left" | "right" | "top" | "bottom";
  size: number;
  tickSpace?: number;
  showTimezone?: boolean;
}`,signature:{properties:[{key:"position",value:{name:"union",raw:'"left" | "right" | "top" | "bottom"',elements:[{name:"literal",value:'"left"'},{name:"literal",value:'"right"'},{name:"literal",value:'"top"'},{name:"literal",value:'"bottom"'}],required:!0}},{key:"size",value:{name:"number",required:!0}},{key:"tickSpace",value:{name:"number",required:!1}},{key:"showTimezone",value:{name:"boolean",required:!1}}]}}],required:!0}},{key:"timeZone",value:{name:"string",required:!0}},{key:"locale",value:{name:"string",required:!1}}]}}]}],raw:"PlotScaleConfig[]",required:!0}}]}},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};export{Re as C,ce as a,z as b,re as c,Ne as d,Y as e,k as f,v as g,je as p,Oe as u,le as v};
