import{j as z}from"./jsx-runtime-D_zvdyIk.js";import{R as X,r as w}from"./iframe-DP0Kcass.js";import{f as Y,h as b,g as F,a as Z,c as q,b as H}from"./CanPlot-d0tERzCM.js";const f=()=>{const o=[];return{addEventListener:(r,s)=>(o.push({syncKey:r,callback:s}),()=>{const i=o.findIndex(l=>l.callback===s);i!==-1&&o.splice(i,1)}),dispatchEvent:(r,s)=>{for(const i of o)i.syncKey===r&&i.callback(r,s)}}},d={dblclick:f(),click:f(),move:f(),mousedown:f(),mouseup:f(),spanselect:f(),documentmouseup:f(),pressandwheel:f(),sync_dblclick:f(),sync_click:f(),sync_move:f(),sync_mousedown:f(),sync_mouseup:f(),sync_spanselect:f(),sync_pressandwheel:f()},h=(o,r,s)=>{const i=X.useRef(s);i.current=s,X.useEffect(()=>d[o].addEventListener(r,(n,u)=>{i.current(u,n)}),[r,o,i])},G=X.createContext(""),oe=(o,r)=>{const s=X.useContext(G);return h(o,s,r)},$=(o,r,s,i,l)=>{if(!r)return;const n=i??s.scales.find(g=>g.origin==="x")?.id,u=l??s.scales.find(g=>g.origin==="y")?.id;if(!n||!u)return;const c=o.clientX-r.left,m={scaleId:n,value:b(s,c,n)},E=o.clientY-r.top,I={scaleId:u,value:b(s,E,u)};return{pointerSyncPosition:{x:m,y:I},cssX:c,cssY:E}},M=(o,r)=>{const s=o.x?Y(r,o.x.value,o.x.scaleId,"css"):0,i=o.y?Y(r,o.y.value,o.y.scaleId,"css"):0;return{cssX:s,cssY:i,scaled:Object.fromEntries(r.scales.map(l=>{const n=l.origin==="y"?i:s;return[l.id,b(r,n,l.id)]}))}},J=(o,r,s)=>{if(!r){const u=o==="x"?s.chartAreaCSS.x:s.chartAreaCSS.y,c=o==="x"?s.chartAreaCSS.x+s.chartAreaCSS.width:s.chartAreaCSS.y+s.chartAreaCSS.height;return{fromCSS:u,toCSS:c,scaled:s.scales.flatMap(m=>{if(m.origin!==o)return[];const{min:E,max:I}=F(s,m.id);return[{scaleId:m.id,from:E,to:I}]})}}const i=Y(s,r.from,r.scaleId,"css"),l=Y(s,r.to,r.scaleId,"css"),n=s.scales.flatMap(u=>{if(u.origin!==o)return[];const c=b(s,i,u.id),m=b(s,l,u.id);return[{scaleId:u.id,from:c,to:m}]});return{fromCSS:i,toCSS:l,scaled:n}},ee=({id:o,onClick:r,onDblClick:s,onMouseMove:i,onMouseDown:l,onMouseUp:n,onDocumentMouseUp:u,onSpanSelect:c,className:m,style:E,sync:I,children:g})=>{const k=w.useId(),v=o||k;return h("dblclick",v,e=>{s?.(e)}),h("click",v,e=>{r?.(e)}),h("move",v,e=>{i?.(e)}),h("mousedown",v,e=>{l?.(e)}),h("mouseup",v,e=>{n?.(e)}),h("documentmouseup",v,e=>{u?.(e)}),h("spanselect",v,e=>{c?.(e)}),z.jsxs(G.Provider,{value:v,children:[z.jsx(te,{className:m,style:E,sync:I}),g]})},te=({className:o,style:r,sync:s})=>{const i=w.useRef(null),l=Z(),n=w.useRef(l);n.current=l;const u=w.useContext(G),c=s?.key||u,m=w.useRef(null),E=w.useRef(null),I=w.useRef(null),g=()=>{const e=i.current?.parentElement;if(e){if(e.dataset.canplotroot===void 0)throw new Error("ChartAreaInteractions must be used within a CanPlot component");return e.getBoundingClientRect()}},k=(e,t)=>{const p=$(e,g(),n.current,s?.xViaScaleId,s?.yViaScaleId);p&&t(p.pointerSyncPosition,{cssX:p.cssX,cssY:p.cssY},{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})},v=w.useRef(k);return v.current=k,w.useEffect(()=>{const e=a=>{const S=E.current;S&&d.sync_spanselect.dispatchEvent(c,{...S,completed:!0}),d.documentmouseup.dispatchEvent(c,{frame:n.current,keys:{ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey}})},t=a=>{const S={ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey},A=I.current;if(A&&Object.entries(S).some(([C,x])=>A.keys[C]!==x)){const C={...A,keys:S};I.current=C,d.sync_move.dispatchEvent(c,C)}const K=E.current;if(K&&Object.entries(S).some(([C,x])=>K.keys[C]!==x)){a.stopPropagation(),a.preventDefault();const C={...K,keys:S};E.current=C,d.sync_spanselect.dispatchEvent(c,C)}},p=a=>{v.current(a,(S,{cssX:A,cssY:K},C)=>{const x=m.current;if(!x||!S.x||!S.y)return;const L=n.current,P=x.xRangeCss.start,j=A,B=x.yRangeCss.start,D=K,O=F(L,S.x.scaleId),T=F(L,S.y.scaleId);m.current={xRangeCss:{start:P,end:j},yRangeCss:{start:B,end:D}};let R="none";const V=Math.abs(B-D),U=Math.abs(P-j);V<10&&U<10?R="none":V>30&&U>30?R="box":V>U?R="y":R="x";const N=R==="x"||R==="box"?{scaleId:O.id,from:b(L,q(n.current,P,"css"),O.id),to:b(L,q(n.current,j,"css"),O.id)}:void 0,Q=R==="y"||R==="box"?{scaleId:T.id,from:b(L,H(n.current,B,"css"),T.id),to:b(L,H(n.current,D,"css"),T.id)}:void 0,W={mode:R,xRange:N,yRange:Q,completed:!1,keys:C};E.current=W,d.sync_spanselect.dispatchEvent(c,W)})},y=a=>{v.current(a,(S,A,K)=>{if(Object.values(K).some(x=>x)){a.preventDefault();const x=Math.abs(a.deltaY)>Math.abs(a.deltaX)?a.deltaY:a.deltaX;d.sync_pressandwheel.dispatchEvent(c,{positions:S,keys:K,deltaX:a.deltaX,deltaY:a.deltaY,deltaAbs:x})}})};document.addEventListener("mouseup",e),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("mousemove",p);const _=i.current;return _?.addEventListener("wheel",y,{passive:!1}),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("mousemove",p),_?.removeEventListener("wheel",y)}},[n,c,v]),h("sync_dblclick",c,e=>{const t=M(e.positions,n.current);t&&d.dblclick.dispatchEvent(u,{frame:n.current,pointer:t,keys:e.keys})}),h("sync_click",c,e=>{const t=M(e.positions,n.current);t&&d.click.dispatchEvent(u,{frame:n.current,pointer:t,keys:e.keys})}),h("sync_move",c,e=>{const t=e.positions?M(e.positions,n.current):null;I.current=e,d.move.dispatchEvent(u,{frame:n.current,pointer:t??null,keys:e.keys})}),h("sync_mousedown",c,e=>{const t=M(e.positions,n.current);t&&d.mousedown.dispatchEvent(u,{frame:n.current,pointer:t,keys:e.keys})}),h("sync_mouseup",c,e=>{const t=M(e.positions,n.current);t&&d.mouseup.dispatchEvent(u,{frame:n.current,pointer:t,keys:e.keys})}),h("sync_pressandwheel",c,e=>{const t=M(e.positions,n.current);t&&d.pressandwheel.dispatchEvent(u,{frame:n.current,pointer:t,keys:e.keys,deltaX:e.deltaX,deltaY:e.deltaY,deltaAbs:e.deltaAbs})}),h("sync_spanselect",c,e=>{const t=J("x",e.xRange,n.current),p=J("y",e.yRange,n.current),y=t.scaled,_=p.scaled;e.completed&&(m.current=null),d.spanselect.dispatchEvent(u,{mode:e.mode,frame:n.current,xRanges:y,yRanges:_,completed:e.completed,x:{fromCSS:t.fromCSS,toCSS:t.toCSS},y:{fromCSS:p.fromCSS,toCSS:p.toCSS},keys:e.keys})}),z.jsx("div",{ref:i,id:"interactions",className:o,style:{position:"absolute",left:l.chartAreaCSS.x,top:l.chartAreaCSS.y,width:l.chartAreaCSS.width,height:l.chartAreaCSS.height,zIndex:25,...r},onClick:e=>{k(e,(t,p,y)=>{d.sync_click.dispatchEvent(c,{positions:t,keys:y})})},onMouseLeave:e=>{k(e,(t,p,y)=>{d.sync_move.dispatchEvent(c,{positions:null,keys:y})})},onMouseMove:e=>{k(e,(t,p,y)=>{d.sync_move.dispatchEvent(c,{positions:t,keys:y})})},onMouseDown:e=>{k(e,(t,{cssX:p,cssY:y},_)=>{d.sync_mousedown.dispatchEvent(c,{positions:t,keys:_}),E.current=null,m.current={xRangeCss:{start:p,end:p},yRangeCss:{start:y,end:y}}})},onMouseUp:e=>{k(e,(t,p,y)=>{d.sync_mouseup.dispatchEvent(c,{positions:t,keys:y});const _=E.current;E.current=null;const a=m.current;if(m.current=null,a&&_){const S={..._,keys:y,completed:!0};d.sync_spanselect.dispatchEvent(c,S)}})},onDoubleClick:e=>{k(e,(t,p,y)=>{d.sync_dblclick.dispatchEvent(c,{positions:t,keys:y})})}})};ee.__docgenInfo={description:"",methods:[],displayName:"ChartAreaInteractions"};export{ee as C,oe as u};
