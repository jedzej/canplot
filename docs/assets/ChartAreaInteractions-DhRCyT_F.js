import{j as q}from"./jsx-runtime-D_zvdyIk.js";import{R as T,r as w}from"./iframe-BgZoRfvH.js";import{i as B,j as k,b as ce,g as ee,e as te,f as ne}from"./frameContext-Co5DpICG.js";const R=()=>{const u=[];return{addEventListener:(n,s)=>(u.push({syncKey:n,callback:s}),()=>{const c=u.findIndex(v=>v.callback===s);c!==-1&&u.splice(c,1)}),dispatchEvent:(n,s)=>{for(const c of u)c.syncKey===n&&c.callback(n,s)}}},h={dblclick:R(),click:R(),contextmenu:R(),move:R(),mousedown:R(),mouseup:R(),spanselect:R(),documentmouseup:R(),pressandwheel:R(),sync_move:R()},g=(u,n,s)=>{const c=T.useRef(s);c.current=s,T.useEffect(()=>h[u].addEventListener(n,(p,o)=>{c.current(o,p)}),[n,u,c])},H=T.createContext(""),pe=(u,n)=>{const s=T.useContext(H);return g(u,s,n)},ae=(u,n,s,c,v)=>{if(!n)return;const p=c??s.scales.find(I=>I.origin==="x")?.id,o=v??s.scales.find(I=>I.origin==="y")?.id,e=u.clientX-n.left,a=p?{scaleId:p,value:k(s,e,p)}:null,x=u.clientY-n.top,K=o?{scaleId:o,value:k(s,x,o)}:null;return{pointerSyncPosition:{x:a,y:K},cssX:e,cssY:x}},_=(u,n)=>{const{x:s,y:c}=u,v=s&&n.scales.some(o=>o.id===s.scaleId)?B(n,s.value,s.scaleId,"css"):null,p=c&&n.scales.some(o=>o.id===c.scaleId)?B(n,c.value,c.scaleId,"css"):null;return{cssX:v,cssY:p,scaled:Object.fromEntries(n.scales.flatMap(o=>{const e=o.origin==="y"?p:v;return e===null?[]:[[o.id,k(n,e,o.id)]]}))}},se=(u,n,s)=>{const c=B(s,n.from,n.scaleId,"css"),v=B(s,n.to,n.scaleId,"css");if(c===null||v===null)return null;const p=s.scales.flatMap(o=>{if(o.origin!==u)return[];const e=k(s,c,o.id),a=k(s,v,o.id);return e===null||a===null?[]:[{scaleId:o.id,from:e,to:a}]});return{fromCSS:c,toCSS:v,scaled:p}},ie=({id:u,onClick:n,onDblClick:s,onMouseMove:c,onMouseDown:v,onMouseUp:p,onDocumentMouseUp:o,onSpanSelect:e,onContextMenu:a,className:x,style:K,sync:I,innerChildren:M,children:O})=>{const d=w.useId();return g("dblclick",d,l=>{s?.(l)}),g("click",d,l=>{n?.(l)}),g("move",d,l=>{c?.(l)}),g("mousedown",d,l=>{v?.(l)}),g("mouseup",d,l=>{p?.(l)}),g("documentmouseup",d,l=>{o?.(l)}),g("spanselect",d,l=>{e?.(l)}),g("contextmenu",d,l=>{a?.(l)}),q.jsxs(H.Provider,{value:d,children:[q.jsx(ue,{id:u,className:x,style:K,sync:I,children:M}),O]})},ue=({id:u,className:n,style:s,sync:c,children:v})=>{const p=w.useRef(null),o=ce().frame,e=w.useRef(o);e.current=o;const a=w.useContext(H),x=c?.key||a,K=w.useRef(null),I=w.useRef(null),M=w.useRef(null),O=()=>{const t=p.current?.parentElement;if(t){if(t.dataset.canplotroot===void 0)throw new Error("ChartAreaInteractions must be used within a CanPlot component");return t.getBoundingClientRect()}},d=(t,i)=>{const f=ae(t,O(),e.current,c?.xViaScaleId,c?.yViaScaleId);f&&i(f.pointerSyncPosition,{cssX:f.cssX,cssY:f.cssY},{ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey})},l=w.useRef(d);return l.current=d,w.useEffect(()=>{const t=r=>{const S=I.current;S&&h.spanselect.dispatchEvent(a,{...S,completed:!0}),h.documentmouseup.dispatchEvent(a,{frame:e.current,keys:{ctrlKey:r.ctrlKey,altKey:r.altKey,shiftKey:r.shiftKey,metaKey:r.metaKey}})},i=r=>{const S={ctrlKey:r.ctrlKey,altKey:r.altKey,shiftKey:r.shiftKey,metaKey:r.metaKey},b=M.current;if(b&&Object.entries(S).some(([E,P])=>b.keys[E]!==P)){const E={...b,keys:S};M.current=E,h.sync_move.dispatchEvent(x,E)}const L=I.current;if(L&&Object.entries(S).some(([E,P])=>L.keys[E]!==P)){r.stopPropagation(),r.preventDefault();const E={...L,keys:S};I.current=E,h.spanselect.dispatchEvent(a,E)}},f=r=>{l.current(r,(S,{cssX:b,cssY:L},E)=>{const P=K.current;if(!P||!S.x||!S.y)return;const C=e.current,V=P.xRangeCss.start,F=b,U=P.yRangeCss.start,z=L,X=ee(C,S.x.scaleId);if(!X)return;const Y=ee(C,S.y.scaleId);if(!Y)return;K.current={xRangeCss:{start:V,end:F},yRangeCss:{start:U,end:z}};let A="below_threshold";const G=Math.abs(U-z),W=Math.abs(V-F);G<10&&W<10?A="below_threshold":G>30&&W>30?A="box":G>W?A="y":A="x";const J=k(C,te(e.current,V,"css"),X.id);if(J===null)return;const N=k(C,te(e.current,F,"css"),X.id);if(N===null)return;const Q=k(C,ne(e.current,U,"css"),Y.id);if(Q===null)return;const Z=k(C,ne(e.current,z,"css"),Y.id);if(Z===null)return;const j=se("x",{scaleId:X.id,from:J,to:N},e.current),D=se("y",{scaleId:Y.id,from:Q,to:Z},e.current),re=j?.scaled,oe=D?.scaled,$={mode:A,frame:e.current,completed:!1,x:{css:j?{from:j.fromCSS,to:j.toCSS}:void 0,scaled:re??[]},y:{css:D?{from:D.fromCSS,to:D.toCSS}:void 0,scaled:oe??[]},keys:E};I.current=$,h.spanselect.dispatchEvent(a,$)})},m=r=>{l.current(r,(S,b,L)=>{const E=_(S,e.current);if(!E)return;if(Object.values(L).some(C=>C)){r.preventDefault();const C=Math.abs(r.deltaY)>Math.abs(r.deltaX)?r.deltaY:r.deltaX;h.pressandwheel.dispatchEvent(a,{pointer:E,frame:e.current,keys:L,deltaX:r.deltaX,deltaY:r.deltaY,deltaAbs:C})}})};document.addEventListener("mouseup",t),document.addEventListener("keydown",i),document.addEventListener("keyup",i),document.addEventListener("mousemove",f);const y=p.current;return y?.addEventListener("wheel",m,{passive:!1}),()=>{document.removeEventListener("mouseup",t),document.removeEventListener("keydown",i),document.removeEventListener("keyup",i),document.removeEventListener("mousemove",f),y?.removeEventListener("wheel",m)}},[e,a,x,l]),g("sync_move",x,t=>{const i=t.positions?_(t.positions,e.current):null;M.current=t,h.move.dispatchEvent(a,{frame:e.current,pointer:i??null,keys:t.keys,source:t.originInteractionsId===a?"own":"sync"})}),q.jsx("div",{ref:p,id:u,className:n,style:{position:"absolute",left:o.chartAreaCSS.x,top:o.chartAreaCSS.y,width:o.chartAreaCSS.width,height:o.chartAreaCSS.height,zIndex:25,...s},onDragStart:t=>{t.preventDefault()},onClick:t=>{d(t,(i,f,m)=>{const y=_(i,e.current);y&&h.click.dispatchEvent(a,{pointer:y,frame:e.current,keys:m})})},onMouseLeave:t=>{d(t,(i,f,m)=>{h.sync_move.dispatchEvent(x,{positions:null,keys:m,originInteractionsId:a})})},onMouseMove:t=>{d(t,(i,f,m)=>{h.sync_move.dispatchEvent(x,{positions:i,keys:m,originInteractionsId:a})})},onMouseDown:t=>{d(t,(i,{cssX:f,cssY:m},y)=>{const r=_(i,e.current);r&&(h.mousedown.dispatchEvent(a,{pointer:r,frame:e.current,keys:y}),K.current={xRangeCss:{start:f,end:f},yRangeCss:{start:m,end:m}})})},onMouseUp:t=>{d(t,(i,f,m)=>{const y=_(i,e.current);if(!y)return;h.mouseup.dispatchEvent(a,{frame:e.current,pointer:y,keys:m});const r=I.current;I.current=null;const S=K.current;if(K.current=null,S&&r){const b={...r,keys:m,completed:!0};I.current=null,h.spanselect.dispatchEvent(a,b)}})},onContextMenu:t=>{t.preventDefault(),d(t,(i,f,m)=>{const y=_(i,e.current);y&&h.contextmenu.dispatchEvent(a,{frame:e.current,pointer:y,keys:m})})},onDoubleClick:t=>{d(t,(i,f,m)=>{const y=_(i,e.current);y&&h.dblclick.dispatchEvent(a,{frame:e.current,pointer:y,keys:m})})},children:v})};ie.__docgenInfo={description:"",methods:[],displayName:"ChartAreaInteractions"};export{ie as C,pe as u};
