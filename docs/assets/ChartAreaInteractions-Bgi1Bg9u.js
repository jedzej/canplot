import{j as z}from"./jsx-runtime-D_zvdyIk.js";import{R as X,r as R}from"./iframe-B_ZNLO9M.js";import{f as Y,h as w,g as F,a as Z,c as q,b as H}from"./CanPlot-DcHqXOCz.js";const m=()=>{const o=[];return{addEventListener:(r,n)=>(o.push({syncKey:r,callback:n}),()=>{const u=o.findIndex(l=>l.callback===n);u!==-1&&o.splice(u,1)}),dispatchEvent:(r,n)=>{for(const u of o)u.syncKey===r&&u.callback(r,n)}}},d={dblclick:m(),click:m(),contextmenu:m(),move:m(),mousedown:m(),mouseup:m(),spanselect:m(),documentmouseup:m(),pressandwheel:m(),sync_dblclick:m(),sync_click:m(),sync_move:m(),sync_mousedown:m(),sync_mouseup:m(),sync_spanselect:m(),sync_pressandwheel:m(),sync_contextmenu:m()},f=(o,r,n)=>{const u=X.useRef(n);u.current=n,X.useEffect(()=>d[o].addEventListener(r,(s,a)=>{u.current(a,s)}),[r,o,u])},G=X.createContext(""),oe=(o,r)=>{const n=X.useContext(G);return f(o,n,r)},$=(o,r,n,u,l)=>{if(!r)return;const s=u??n.scales.find(K=>K.origin==="x")?.id,a=l??n.scales.find(K=>K.origin==="y")?.id;if(!s||!a)return;const c=o.clientX-r.left,S={scaleId:s,value:w(n,c,s)},E=o.clientY-r.top,k={scaleId:a,value:w(n,E,a)};return{pointerSyncPosition:{x:S,y:k},cssX:c,cssY:E}},g=(o,r)=>{const n=o.x?Y(r,o.x.value,o.x.scaleId,"css"):0,u=o.y?Y(r,o.y.value,o.y.scaleId,"css"):0;return{cssX:n,cssY:u,scaled:Object.fromEntries(r.scales.map(l=>{const s=l.origin==="y"?u:n;return[l.id,w(r,s,l.id)]}))}},J=(o,r,n)=>{if(!r){const a=o==="x"?n.chartAreaCSS.x:n.chartAreaCSS.y,c=o==="x"?n.chartAreaCSS.x+n.chartAreaCSS.width:n.chartAreaCSS.y+n.chartAreaCSS.height;return{fromCSS:a,toCSS:c,scaled:n.scales.flatMap(S=>{if(S.origin!==o)return[];const{min:E,max:k}=F(n,S.id);return[{scaleId:S.id,from:E,to:k}]})}}const u=Y(n,r.from,r.scaleId,"css"),l=Y(n,r.to,r.scaleId,"css"),s=n.scales.flatMap(a=>{if(a.origin!==o)return[];const c=w(n,u,a.id),S=w(n,l,a.id);return[{scaleId:a.id,from:c,to:S}]});return{fromCSS:u,toCSS:l,scaled:s}},ee=({id:o,onClick:r,onDblClick:n,onMouseMove:u,onMouseDown:l,onMouseUp:s,onDocumentMouseUp:a,onSpanSelect:c,onContextMenu:S,className:E,style:k,sync:K,children:x})=>{const A=R.useId(),e=o||A;return f("dblclick",e,t=>{n?.(t)}),f("click",e,t=>{r?.(t)}),f("move",e,t=>{u?.(t)}),f("mousedown",e,t=>{l?.(t)}),f("mouseup",e,t=>{s?.(t)}),f("documentmouseup",e,t=>{a?.(t)}),f("spanselect",e,t=>{c?.(t)}),f("contextmenu",e,t=>{S?.(t)}),z.jsxs(G.Provider,{value:e,children:[z.jsx(te,{className:E,style:k,sync:K}),x]})},te=({className:o,style:r,sync:n})=>{const u=R.useRef(null),l=Z(),s=R.useRef(l);s.current=l;const a=R.useContext(G),c=n?.key||a,S=R.useRef(null),E=R.useRef(null),k=R.useRef(null),K=()=>{const e=u.current?.parentElement;if(e){if(e.dataset.canplotroot===void 0)throw new Error("ChartAreaInteractions must be used within a CanPlot component");return e.getBoundingClientRect()}},x=(e,t)=>{const p=$(e,K(),s.current,n?.xViaScaleId,n?.yViaScaleId);p&&t(p.pointerSyncPosition,{cssX:p.cssX,cssY:p.cssY},{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})},A=R.useRef(x);return A.current=x,R.useEffect(()=>{const e=i=>{const h=E.current;h&&d.sync_spanselect.dispatchEvent(c,{...h,completed:!0}),d.documentmouseup.dispatchEvent(c,{frame:s.current,keys:{ctrlKey:i.ctrlKey,altKey:i.altKey,shiftKey:i.shiftKey,metaKey:i.metaKey}})},t=i=>{const h={ctrlKey:i.ctrlKey,altKey:i.altKey,shiftKey:i.shiftKey,metaKey:i.metaKey},L=k.current;if(L&&Object.entries(h).some(([v,C])=>L.keys[v]!==C)){const v={...L,keys:h};k.current=v,d.sync_move.dispatchEvent(c,v)}const b=E.current;if(b&&Object.entries(h).some(([v,C])=>b.keys[v]!==C)){i.stopPropagation(),i.preventDefault();const v={...b,keys:h};E.current=v,d.sync_spanselect.dispatchEvent(c,v)}},p=i=>{A.current(i,(h,{cssX:L,cssY:b},v)=>{const C=S.current;if(!C||!h.x||!h.y)return;const M=s.current,P=C.xRangeCss.start,j=L,D=C.yRangeCss.start,B=b,O=F(M,h.x.scaleId),T=F(M,h.y.scaleId);S.current={xRangeCss:{start:P,end:j},yRangeCss:{start:D,end:B}};let I="none";const V=Math.abs(D-B),U=Math.abs(P-j);V<10&&U<10?I="none":V>30&&U>30?I="box":V>U?I="y":I="x";const N=I==="x"||I==="box"?{scaleId:O.id,from:w(M,q(s.current,P,"css"),O.id),to:w(M,q(s.current,j,"css"),O.id)}:void 0,Q=I==="y"||I==="box"?{scaleId:T.id,from:w(M,H(s.current,D,"css"),T.id),to:w(M,H(s.current,B,"css"),T.id)}:void 0,W={mode:I,xRange:N,yRange:Q,completed:!1,keys:v};E.current=W,d.sync_spanselect.dispatchEvent(c,W)})},y=i=>{A.current(i,(h,L,b)=>{if(Object.values(b).some(C=>C)){i.preventDefault();const C=Math.abs(i.deltaY)>Math.abs(i.deltaX)?i.deltaY:i.deltaX;d.sync_pressandwheel.dispatchEvent(c,{positions:h,keys:b,deltaX:i.deltaX,deltaY:i.deltaY,deltaAbs:C})}})};document.addEventListener("mouseup",e),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("mousemove",p);const _=u.current;return _?.addEventListener("wheel",y,{passive:!1}),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("mousemove",p),_?.removeEventListener("wheel",y)}},[s,c,A]),f("sync_dblclick",c,e=>{const t=g(e.positions,s.current);t&&d.dblclick.dispatchEvent(a,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_click",c,e=>{const t=g(e.positions,s.current);t&&d.click.dispatchEvent(a,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_contextmenu",c,e=>{const t=g(e.positions,s.current);t&&d.contextmenu.dispatchEvent(a,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_move",c,e=>{const t=e.positions?g(e.positions,s.current):null;k.current=e,d.move.dispatchEvent(a,{frame:s.current,pointer:t??null,keys:e.keys})}),f("sync_mousedown",c,e=>{const t=g(e.positions,s.current);t&&d.mousedown.dispatchEvent(a,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_mouseup",c,e=>{const t=g(e.positions,s.current);t&&d.mouseup.dispatchEvent(a,{frame:s.current,pointer:t,keys:e.keys})}),f("sync_pressandwheel",c,e=>{const t=g(e.positions,s.current);t&&d.pressandwheel.dispatchEvent(a,{frame:s.current,pointer:t,keys:e.keys,deltaX:e.deltaX,deltaY:e.deltaY,deltaAbs:e.deltaAbs})}),f("sync_spanselect",c,e=>{const t=J("x",e.xRange,s.current),p=J("y",e.yRange,s.current),y=t.scaled,_=p.scaled;e.completed&&(S.current=null),d.spanselect.dispatchEvent(a,{mode:e.mode,frame:s.current,xRanges:y,yRanges:_,completed:e.completed,x:{fromCSS:t.fromCSS,toCSS:t.toCSS},y:{fromCSS:p.fromCSS,toCSS:p.toCSS},keys:e.keys})}),z.jsx("div",{ref:u,id:"interactions",className:o,style:{position:"absolute",left:l.chartAreaCSS.x,top:l.chartAreaCSS.y,width:l.chartAreaCSS.width,height:l.chartAreaCSS.height,zIndex:25,...r},onDragStart:e=>{e.preventDefault()},onClick:e=>{x(e,(t,p,y)=>{d.sync_click.dispatchEvent(c,{positions:t,keys:y})})},onMouseLeave:e=>{x(e,(t,p,y)=>{d.sync_move.dispatchEvent(c,{positions:null,keys:y})})},onMouseMove:e=>{x(e,(t,p,y)=>{d.sync_move.dispatchEvent(c,{positions:t,keys:y})})},onMouseDown:e=>{x(e,(t,{cssX:p,cssY:y},_)=>{d.sync_mousedown.dispatchEvent(c,{positions:t,keys:_}),E.current=null,S.current={xRangeCss:{start:p,end:p},yRangeCss:{start:y,end:y}}})},onMouseUp:e=>{x(e,(t,p,y)=>{d.sync_mouseup.dispatchEvent(c,{positions:t,keys:y});const _=E.current;E.current=null;const i=S.current;if(S.current=null,i&&_){const h={..._,keys:y,completed:!0};d.sync_spanselect.dispatchEvent(c,h)}})},onContextMenu:e=>{e.preventDefault(),x(e,(t,p,y)=>{d.sync_contextmenu.dispatchEvent(c,{positions:t,keys:y})})},onDoubleClick:e=>{x(e,(t,p,y)=>{d.sync_dblclick.dispatchEvent(c,{positions:t,keys:y})})}})};ee.__docgenInfo={description:"",methods:[],displayName:"ChartAreaInteractions"};export{ee as C,oe as u};
