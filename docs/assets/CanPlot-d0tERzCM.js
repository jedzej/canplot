import{j as g}from"./jsx-runtime-D_zvdyIk.js";import{R as y,r as c}from"./iframe-DP0Kcass.js";const S=(e,t,i)=>Math.min(Math.max(e,t),i),U=(e,t,i,a)=>{const{min:n,max:r}=p(e,i),o=e.chartAreaCanvasPX,l=(v(e,i)?o.width:o.height)/(r-n);return t/l},p=(e,t)=>{const i=e.scales.find(a=>a.id===t);if(!i)throw new Error(`Scale ${t} not found`);return i},v=(e,t)=>e.scales.find(i=>i.id===t)?.origin==="x",T=(e,t)=>{const i=window.devicePixelRatio||1;e.lineCap=t?.lineCap??"butt",e.lineDashOffset=i*(t?.lineDashOffset??0),e.lineJoin=t?.lineJoin??"miter",e.lineWidth=i*(t?.lineWidth??1),e.miterLimit=i*(t?.miterLimit??10),e.strokeStyle=t?.strokeStyle??"black",e.fillStyle=t?.fillStyle??e.strokeStyle,e.font=t?.font??`${10*i}px sans-serif`,e.textAlign=t?.textAlign??"start",e.direction=t?.direction??"inherit",e.textBaseline=t?.textBaseline??"alphabetic",e.fontKerning=t?.fontKerning??"auto"},k=(e,t,i,a)=>{const n=a==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,{min:r,max:o}=p(e,i),l=(v(e,i)?n.width:n.height)/(o-r);return t*l},F=(e,t,i,a)=>{const{min:n}=p(e,i),r=a==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS,o=k(e,t-n,i,a);return v(e,i)?S(r.x+o,r.x-10*r.width,r.x+11*r.width):S(r.y+r.height-o,r.y-10*r.height,r.y+11*r.height)},D=(e,t,i)=>{const a=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return S(t,a.x,a.x+a.width)},z=(e,t,i)=>{const a=i==="canvas"?e.chartAreaCanvasPX:e.chartAreaCSS;return S(t,a.y,a.y+a.height)},E=(e,t,i)=>{const{min:a,max:n}=p(e,i);return t>=a&&t<=n},Y=(e,t,i,a)=>{const{min:n,max:r}=p(e,i),o=e.chartAreaCSS,l=v(e,i)?(t-o.x)/o.width:(o.height-t+o.y)/o.height;return n+l*(r-n)},O=e=>{const{ctx:t,scales:i}=e;for(const a of i){if(!a.axis)continue;t.save(),T(t,{strokeStyle:"black",fillStyle:"black",lineWidth:1,...a.axis.style});const n=a.axis.canvasRect;if(a.origin==="x"){if(a.axis.position==="bottom")t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.x+n.width,n.y),t.stroke();else if(a.axis.position==="top"){const r=n.y+n.height;t.beginPath(),t.moveTo(n.x,r),t.lineTo(n.x+n.width,r),t.stroke()}}else if(a.axis.position==="left"){const r=n.x+n.width;t.beginPath(),t.moveTo(r,n.y),t.lineTo(r,n.y+n.height),t.stroke()}else a.axis.position==="right"&&(t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(n.x,n.y+n.height),t.stroke());t.restore()}},C=e=>{let t;const i=new Set,a=(m,f)=>{const h=typeof m=="function"?m(t):m;if(!Object.is(h,t)){const x=t;t=f??(typeof h!="object"||h===null)?h:Object.assign({},t,h),i.forEach(s=>s(t,x))}},n=()=>t,l={setState:a,getState:n,getInitialState:()=>u,subscribe:m=>(i.add(m),()=>i.delete(m))},u=t=e(a,n,l);return l},P=(e=>e?C(e):C),j=e=>e;function R(e,t=j){const i=y.useSyncExternalStore(e.subscribe,y.useCallback(()=>t(e.getState()),[e,t]),y.useCallback(()=>t(e.getInitialState()),[e,t]));return y.useDebugValue(i),i}const _=()=>P((e,t)=>{const i=()=>{const a=t()._frame;if(!a)throw new Error("No frame set in frame store");return a};return{_frame:null,getFrame:i,getCtx:()=>i().ctx,clampXPosToChartArea:(a,n)=>D(i(),a,n??"canvas"),clampYPosToChartArea:(a,n)=>z(i(),a,n??"canvas"),valToPos:(a,n,r)=>F(i(),a,n,r??"canvas"),valToPxDistance:(a,n,r)=>k(i(),a,n,r??"canvas"),valFits:(a,n)=>E(i(),a,n),getScale:a=>p(i(),a)}}),L=()=>P(e=>({notify:()=>{e(t=>({version:t.version+1}))},version:0})),b=c.createContext(null),A=c.createContext(null),H=(e,t)=>{const i=c.useContext(b),a=c.useContext(A);if(!i||!a)throw new Error("useFrame must be used within a CanPlot component");const n=c.useRef(e);n.current=e,c.useLayoutEffect(()=>{n.current(i.getState()),i.subscribe(r=>{r._frame&&n.current(r)})},[i]),c.useEffect(()=>{a.getState().notify()},[a,...t])},G=e=>{const t=c.useContext(b);if(!t)throw new Error("useFrame must be used within a CanPlot component");return R(t,e??(i=>i.getFrame()))};function W(e){return t=>{for(const i of e)w(i,t)}}function X(e){return t=>{const i=[];for(const a of e){const n=w(a,t),r=typeof n=="function";i.push(r?n:()=>w(a,null))}return()=>{for(const a of i)a()}}}function w(e,t){if(typeof e=="function")return e(t);e&&(e.current=t)}var M=parseInt(c.version.split(".")[0],10)>=19?X:W;const J=c.forwardRef(({configuration:e,children:t,style:i,className:a},n)=>{const r=c.useRef(null),o=c.useRef(null),l=$(o),u=c.useMemo(_,[]),m=c.useMemo(L,[]);c.useLayoutEffect(()=>{u.setState({_frame:B(e,l,r.current)})},[e,l,r,u]),c.useLayoutEffect(()=>u.subscribe(h=>{h._frame&&V(h._frame)}),[u]),c.useLayoutEffect(()=>{let h=!1;return m.subscribe(()=>{h||(h=!0,window.requestAnimationFrame(()=>{h=!1,u.setState(x=>({_frame:x._frame?{...x._frame}:null}))}))})},[m,u]);const f=window.devicePixelRatio||1;return g.jsxs("div",{ref:M([n,o]),className:a,style:{position:"relative",overflow:"hidden",...i},"data-canplotroot":!0,children:[g.jsx("canvas",{ref:r,width:l.width*f,height:l.height*f,style:{inset:0,position:"absolute",width:`${l.width}px`,height:`${l.height}px`}}),g.jsx(N,{frameStore:u,updateRequestStore:m,children:t})]})}),N=({frameStore:e,updateRequestStore:t,children:i})=>R(e,n=>!!n._frame)?g.jsx(A.Provider,{value:t,children:g.jsx(b.Provider,{value:e,children:i})}):null,$=e=>{const[t,i]=c.useState({width:0,height:0}),[a]=c.useState(()=>new ResizeObserver(n=>{for(const r of n){const o=Math.round(r.contentRect.width),l=Math.round(r.contentRect.height);i(u=>u.width!==o||u.height!==l?{...u,width:o,height:l}:u)}}));return c.useLayoutEffect(()=>{if(!e.current)return;const n=e.current.clientWidth,r=e.current.clientHeight;return i(o=>o.width!==n||o.height!==r?{...o,width:n,height:r}:o),a.observe(e.current,{box:"border-box"}),()=>a.disconnect()},[a,e]),t},B=(e,t,i)=>{const a=i?.getContext("2d");if(!a)return null;const n=window.devicePixelRatio||1;if(t.width===0||t.height===0)return null;const r={x:e.padding.left,y:e.padding.top,width:t.width-e.padding.left-e.padding.right,height:t.height-e.padding.top-e.padding.bottom};for(const s of e.scales)s.axis&&(s.origin==="x"?(s.axis.position==="bottom"||s.axis.position==="top")&&(r.height=Math.max(0,r.height-s.axis.size),s.axis.position==="top"&&(r.y+=s.axis.size)):(s.axis.position==="left"||s.axis.position==="right")&&(r.width=Math.max(0,r.width-s.axis.size),s.axis.position==="left"&&(r.x+=s.axis.size)));const o={x:r.x*n,y:r.y*n,width:r.width*n,height:r.height*n},l=[];let u=e.padding.left*n,m=a.canvas.width-e.padding.right*n,f=a.canvas.height-e.padding.bottom*n,h=e.padding.top*n;for(const s of e.scales){if(!s.axis){l.push({...s,axis:null});continue}let d;if(s.origin==="x")switch(s.axis.position){case"bottom":f-=s.axis.size*n,d={x:r.x,y:f/n,width:r.width,height:s.axis.size};break;case"top":h+=s.axis.size*n,d={x:r.x,y:h/n-s.axis.size,width:r.width,height:s.axis.size};break;case"left":case"right":throw new Error("Invalid axis position for x origin")}else switch(s.axis.position){case"left":u+=s.axis.size*n,d={x:u/n-s.axis.size,y:r.y,width:s.axis.size,height:r.height};break;case"right":m-=s.axis.size*n,d={x:m/n,y:r.y,width:s.axis.size,height:r.height};break;case"top":case"bottom":throw new Error("Invalid axis position for y origin")}const q={x:d.x*n,y:d.y*n,width:d.width*n,height:d.height*n};l.push({...s,axis:{...s.axis,cssRect:d,canvasRect:q}})}return{ctx:a,dpr:n,padding:e.padding,scales:l,chartAreaCSS:r,chartAreaCanvasPX:o}},V=e=>{e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),O(e)};J.__docgenInfo={description:"",methods:[],displayName:"CanPlot",props:{configuration:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  padding: PlotPadding;
  scales: PlotScaleConfig[];
}`,signature:{properties:[{key:"padding",value:{name:"signature",type:"object",raw:`{
  top: number;
  bottom: number;
  left: number;
  right: number;
}`,signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"bottom",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}},{key:"right",value:{name:"number",required:!0}}]},required:!0}},{key:"scales",value:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  min: number;
  max: number;
  origin: "x" | "y";
  axis: null | PlotAxis;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"min",value:{name:"number",required:!0}},{key:"max",value:{name:"number",required:!0}},{key:"origin",value:{name:"union",raw:'"x" | "y"',elements:[{name:"literal",value:'"x"'},{name:"literal",value:'"y"'}],required:!0}},{key:"axis",value:{name:"union",raw:"null | PlotAxis",elements:[{name:"null"},{name:"signature",type:"object",raw:`{
  position: "left" | "right" | "top" | "bottom";
  size: number;
  style?: Style;
}`,signature:{properties:[{key:"position",value:{name:"union",raw:'"left" | "right" | "top" | "bottom"',elements:[{name:"literal",value:'"left"'},{name:"literal",value:'"right"'},{name:"literal",value:'"top"'},{name:"literal",value:'"bottom"'}],required:!0}},{key:"size",value:{name:"number",required:!0}},{key:"style",value:{name:"intersection",raw:`{
  fillStyle?: CanvasFillStrokeStyles["fillStyle"];
  strokeStyle?: CanvasFillStrokeStyles["strokeStyle"];
} & Partial<
  Pick<
    CanvasPathDrawingStyles,
    "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
  >
> &
  Partial<CanvasTextDrawingStyles>`,elements:[{name:"signature",type:"object",raw:`{
  fillStyle?: CanvasFillStrokeStyles["fillStyle"];
  strokeStyle?: CanvasFillStrokeStyles["strokeStyle"];
}`,signature:{properties:[{key:"fillStyle",value:{name:'CanvasFillStrokeStyles["fillStyle"]',raw:'CanvasFillStrokeStyles["fillStyle"]',required:!1}},{key:"strokeStyle",value:{name:'CanvasFillStrokeStyles["strokeStyle"]',raw:'CanvasFillStrokeStyles["strokeStyle"]',required:!1}}]}},{name:"Partial",elements:[{name:"Pick",elements:[{name:"CanvasPathDrawingStyles"},{name:"union",raw:'"lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"',elements:[{name:"literal",value:'"lineCap"'},{name:"literal",value:'"lineDashOffset"'},{name:"literal",value:'"lineJoin"'},{name:"literal",value:'"lineWidth"'},{name:"literal",value:'"miterLimit"'}]}],raw:`Pick<
  CanvasPathDrawingStyles,
  "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
>`}],raw:`Partial<
  Pick<
    CanvasPathDrawingStyles,
    "lineCap" | "lineDashOffset" | "lineJoin" | "lineWidth" | "miterLimit"
  >
>`},{name:"Partial",elements:[{name:"CanvasTextDrawingStyles"}],raw:"Partial<CanvasTextDrawingStyles>"}],required:!1}}]}}],required:!0}}]}}],raw:"PlotScaleConfig[]",required:!0}}]}},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};export{J as C,G as a,z as b,D as c,T as d,k as e,F as f,p as g,Y as h,U as p,H as u,E as v};
