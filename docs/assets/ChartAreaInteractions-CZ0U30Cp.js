import{j as G}from"./jsx-runtime-D_zvdyIk.js";import{R as Y,r as R}from"./iframe-C1CH_hI7.js";import{f as j,h as K,a as ne,g as N,c as Q,d as Z}from"./CanPlot-D1VaopC9.js";const x=()=>{const i=[];return{addEventListener:(r,c)=>(i.push({syncKey:r,callback:c}),()=>{const a=i.findIndex(u=>u.callback===c);a!==-1&&i.splice(a,1)}),dispatchEvent:(r,c)=>{for(const a of i)a.syncKey===r&&a.callback(r,c)}}},f={dblclick:x(),click:x(),contextmenu:x(),move:x(),mousedown:x(),mouseup:x(),spanselect:x(),documentmouseup:x(),pressandwheel:x(),sync_move:x()},C=(i,r,c)=>{const a=Y.useRef(c);a.current=c,Y.useEffect(()=>f[i].addEventListener(r,(t,s)=>{a.current(s,t)}),[r,i,a])},W=Y.createContext(""),ue=(i,r)=>{const c=Y.useContext(W);return C(i,c,r)},se=(i,r,c,a,u)=>{if(!r)return;const t=a??c.scales.find(L=>L.origin==="x")?.id,s=u??c.scales.find(L=>L.origin==="y")?.id;if(!t||!s)return;const y=i.clientX-r.left,v={scaleId:t,value:K(c,y,t)},h=i.clientY-r.top,b={scaleId:s,value:K(c,h,s)};return{pointerSyncPosition:{x:v,y:b},cssX:y,cssY:h}},_=(i,r)=>{const{x:c,y:a}=i,u=c&&r.scales.some(s=>s.id===c.scaleId)?j(r,c.value,c.scaleId,"css"):null,t=a&&r.scales.some(s=>s.id===a.scaleId)?j(r,a.value,a.scaleId,"css"):null;return{cssX:u,cssY:t,scaled:Object.fromEntries(r.scales.flatMap(s=>{const y=s.origin==="y"?t:u;return y===null?[]:[[s.id,K(r,y,s.id)]]}))}},$=(i,r,c)=>{const a=j(c,r.from,r.scaleId,"css"),u=j(c,r.to,r.scaleId,"css"),t=c.scales.flatMap(s=>{if(s.origin!==i)return[];const y=K(c,a,s.id),v=K(c,u,s.id);return[{scaleId:s.id,from:y,to:v}]});return{fromCSS:a,toCSS:u,scaled:t}},ce=({id:i,onClick:r,onDblClick:c,onMouseMove:a,onMouseDown:u,onMouseUp:t,onDocumentMouseUp:s,onSpanSelect:y,onContextMenu:v,className:h,style:b,sync:L,children:E})=>{const P=R.useId(),e=i||P;return C("dblclick",e,n=>{c?.(n)}),C("click",e,n=>{r?.(n)}),C("move",e,n=>{a?.(n)}),C("mousedown",e,n=>{u?.(n)}),C("mouseup",e,n=>{t?.(n)}),C("documentmouseup",e,n=>{s?.(n)}),C("spanselect",e,n=>{y?.(n)}),C("contextmenu",e,n=>{v?.(n)}),G.jsxs(W.Provider,{value:e,children:[G.jsx(re,{className:h,style:b,sync:L}),E]})},re=({className:i,style:r,sync:c})=>{const a=R.useRef(null),u=ne(),t=R.useRef(u);t.current=u;const s=R.useContext(W),y=c?.key||s,v=R.useRef(null),h=R.useRef(null),b=R.useRef(null),L=()=>{const e=a.current?.parentElement;if(e){if(e.dataset.canplotroot===void 0)throw new Error("ChartAreaInteractions must be used within a CanPlot component");return e.getBoundingClientRect()}},E=(e,n)=>{const d=se(e,L(),t.current,c?.xViaScaleId,c?.yViaScaleId);d&&n(d.pointerSyncPosition,{cssX:d.cssX,cssY:d.cssY},{ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey})},P=R.useRef(E);return P.current=E,R.useEffect(()=>{const e=o=>{const m=h.current;m&&f.spanselect.dispatchEvent(s,{...m,completed:!0}),f.documentmouseup.dispatchEvent(s,{frame:t.current,keys:{ctrlKey:o.ctrlKey,altKey:o.altKey,shiftKey:o.shiftKey,metaKey:o.metaKey}})},n=o=>{const m={ctrlKey:o.ctrlKey,altKey:o.altKey,shiftKey:o.shiftKey,metaKey:o.metaKey},g=b.current;if(g&&Object.entries(m).some(([S,w])=>g.keys[S]!==w)){const S={...g,keys:m};b.current=S,f.sync_move.dispatchEvent(y,S)}const k=h.current;if(k&&Object.entries(m).some(([S,w])=>k.keys[S]!==w)){o.stopPropagation(),o.preventDefault();const S={...k,keys:m};h.current=S,f.spanselect.dispatchEvent(s,S)}},d=o=>{P.current(o,(m,{cssX:g,cssY:k},S)=>{const w=v.current;if(!w||!m.x||!m.y)return;const I=t.current,D=w.xRangeCss.start,B=g,O=w.yRangeCss.start,T=k,V=N(I,m.x.scaleId),U=N(I,m.y.scaleId);v.current={xRangeCss:{start:D,end:B},yRangeCss:{start:O,end:T}};let M="below_threshold";const z=Math.abs(O-T),F=Math.abs(D-B);z<10&&F<10?M="below_threshold":z>30&&F>30?M="box":z>F?M="y":M="x";const q={scaleId:V.id,from:K(I,Q(t.current,D,"css"),V.id),to:K(I,Q(t.current,B,"css"),V.id)},H={scaleId:U.id,from:K(I,Z(t.current,O,"css"),U.id),to:K(I,Z(t.current,T,"css"),U.id)},A=q&&$("x",q,t.current),X=H&&$("y",H,t.current),ee=A?.scaled,te=X?.scaled,J={mode:M,frame:t.current,completed:!1,x:{css:A&&{from:A.fromCSS,to:A.toCSS},scaled:ee??[]},y:{css:X&&{from:X.fromCSS,to:X.toCSS},scaled:te??[]},keys:S};h.current=J,f.spanselect.dispatchEvent(s,J)})},l=o=>{P.current(o,(m,g,k)=>{const S=_(m,t.current);if(!S)return;if(Object.values(k).some(I=>I)){o.preventDefault();const I=Math.abs(o.deltaY)>Math.abs(o.deltaX)?o.deltaY:o.deltaX;f.pressandwheel.dispatchEvent(s,{pointer:S,frame:t.current,keys:k,deltaX:o.deltaX,deltaY:o.deltaY,deltaAbs:I})}})};document.addEventListener("mouseup",e),document.addEventListener("keydown",n),document.addEventListener("keyup",n),document.addEventListener("mousemove",d);const p=a.current;return p?.addEventListener("wheel",l,{passive:!1}),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("keydown",n),document.removeEventListener("keyup",n),document.removeEventListener("mousemove",d),p?.removeEventListener("wheel",l)}},[t,s,y,P]),C("sync_move",y,e=>{const n=e.positions?_(e.positions,t.current):null;b.current=e,f.move.dispatchEvent(s,{frame:t.current,pointer:n??null,keys:e.keys})}),G.jsx("div",{ref:a,id:"interactions",className:i,style:{position:"absolute",left:u.chartAreaCSS.x,top:u.chartAreaCSS.y,width:u.chartAreaCSS.width,height:u.chartAreaCSS.height,zIndex:25,...r},onDragStart:e=>{e.preventDefault()},onClick:e=>{E(e,(n,d,l)=>{const p=_(n,t.current);p&&f.click.dispatchEvent(s,{pointer:p,frame:t.current,keys:l})})},onMouseLeave:e=>{E(e,(n,d,l)=>{f.sync_move.dispatchEvent(s,{positions:null,keys:l})})},onMouseMove:e=>{E(e,(n,d,l)=>{f.sync_move.dispatchEvent(y,{positions:n,keys:l})})},onMouseDown:e=>{E(e,(n,{cssX:d,cssY:l},p)=>{const o=_(n,t.current);o&&(f.mousedown.dispatchEvent(s,{pointer:o,frame:t.current,keys:p}),v.current={xRangeCss:{start:d,end:d},yRangeCss:{start:l,end:l}})})},onMouseUp:e=>{E(e,(n,d,l)=>{const p=_(n,t.current);if(!p)return;f.mouseup.dispatchEvent(s,{frame:t.current,pointer:p,keys:l});const o=h.current;h.current=null;const m=v.current;if(v.current=null,m&&o){const g={...o,keys:l,completed:!0};h.current=null,f.spanselect.dispatchEvent(s,g)}})},onContextMenu:e=>{e.preventDefault(),E(e,(n,d,l)=>{const p=_(n,t.current);p&&f.contextmenu.dispatchEvent(s,{frame:t.current,pointer:p,keys:l})})},onDoubleClick:e=>{E(e,(n,d,l)=>{const p=_(n,t.current);p&&f.dblclick.dispatchEvent(s,{frame:t.current,pointer:p,keys:l})})}})};ce.__docgenInfo={description:"",methods:[],displayName:"ChartAreaInteractions"};export{ce as C,ue as u};
